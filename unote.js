window.notes=[];window.currentNote=null;window.visibleNotes=localStorage.getItem('visibleNotes')?parseInt(localStorage.getItem('visibleNotes')):1;window.isHomepage=true;window.currentApp='home';window.fontSize=localStorage.getItem('fontSize')?parseInt(localStorage.getItem('fontSize')):14;window.undoStack=[];window.redoStack=[];window.dob=localStorage.getItem('dob')||'';window.maxNotes=15;window.homepage=null;window.noteAppContainer=null;window.diffCheckerContainer=null;window.topbar=null;window.themeToggle=null;window.undoBtn=null;window.redoBtn=null;window.homeBtn=null;window.sidebar1=null;window.sidebar1Toggle=null;window.noteList=null;window.noteTextarea=null;window.showNextNoteBtn=null;window.hideLastNoteBtn=null;window.sidebar2Toggle=null;window.secondarySidebar=null;window.notification=null;window.noteAppBtn=null;window.diffCheckerBtn=null;window.infoName=null;window.infoCharsWith=null;window.infoCharsWithout=null;window.infoWords=null;window.infoReadTime=null;window.infoExtension=null;
window.initApp=function(){if(!document.getElementById("modal-dark-css")){var e=document.createElement("style");e.id="modal-dark-css";e.textContent=":root{--modal-bg:#272727;--modal-surface:#171717;--modal-ink:#eeeeee;--modal-muted:#9aa8b7;--accent-2:linear-gradient(45deg,#6a5acd,#60a5fa);--danger:#ff6b6b;--glass:rgba(255,255,255,0.02);--border:rgba(255,255,255,0.06);--shadow:0 10px 30px rgba(2,6,23,0.6);--radius:12px;--gap:12px;--transition-speed:180ms;--z-modal:99999;--focus-ring:3px;--input-bg:#373727}.modal-backdrop{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;background:linear-gradient(180deg,rgba(3,6,12,0.6),rgba(6,8,14,0.7));z-index:var(--z-modal);padding:20px;-webkit-tap-highlight-color:transparent}.modal-backdrop.active{display:flex}.modal-window{width:780px;max-width:calc(100% - 40px);background:linear-gradient(180deg,var(--modal-surface),var(--modal-bg));color:var(--modal-ink);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;max-height:calc(100vh - 4vh);border:1px solid var(--border);transform:translateY(-8px);opacity:0;transition:transform var(--transition-speed) ease,opacity var(--transition-speed) ease;margin-top:2vh}.modal-backdrop.active .modal-window{transform:translateY(0);opacity:1}.modal-header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:space-between;gap:var(--gap)}.modal-title{margin:0;font-size:1.05rem;font-weight:700;color:var(--modal-ink);line-height:1}.modal-close{background:transparent;border:none;color:var(--modal-muted);font-size:18px;padding:6px;cursor:pointer;border-radius:8px}.modal-close:focus{outline:none;box-shadow:0 0 0 var(--focus-ring) rgba(102,126,234,0.12)}.modal-body{padding:16px 18px;overflow:auto;display:flex;flex-direction:column;gap:12px;color:var(--modal-ink);font-size:14px}.modal-row{display:flex;gap:10px;align-items:center;flex-wrap:nowrap;justify-content:center}.modal-row[data-position=left]{justify-content:flex-start}.modal-row[data-position=right]{justify-content:flex-end}.modal-row .modal-element{flex:1 1 auto;min-width:110px}.modal-label{display:block;font-size:13px;color:var(--modal-muted);margin-bottom:6px}.modal-message{color:var(--modal-ink);background:transparent;padding:2px 0;font-size:14px}.modal-input,.modal-select,.modal-textarea,.custom-dropdown-trigger{width:100%;padding:10px 12px;border-radius:8px;border:1px solid var(--border);background:var(--input-bg);color:var(--modal-ink);font-size:14px;box-sizing:border-box;outline:none;font-family:'Source Code Pro',monospace;transition:box-shadow var(--transition-speed),transform var(--transition-speed),background var(--transition-speed)}.modal-input::placeholder,.modal-textarea::placeholder{color:rgba(230,238,248,0.32)}.modal-input:focus,.modal-select:focus,.modal-textarea:focus,.custom-dropdown-trigger:focus{box-shadow:0 0 0 var(--focus-ring) rgba(100,116,255,0.08);border-color:rgba(100,116,255,0.18);transform:translateY(-1px)}.modal-textarea{min-height:84px;resize:vertical}.custom-dropdown-trigger{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding-right:32px;position:relative}.custom-dropdown-trigger::after{content:'\\25BC';position:absolute;right:12px;top:50%;transform:translateY(-50%);color:var(--modal-muted);font-size:12px;pointer-events:none}.custom-dropdown{position:relative}.custom-dropdown-portal-menu{position:absolute!important;min-width:180px;box-shadow:0 8px 20px rgba(2,6,23,0.6);z-index:100001!important;background:var(--modal-surface);border-radius:8px;border:1px solid var(--border);max-height:70vh;overflow:auto;left:0;top:0;display:none}.custom-dropdown-portal-menu.active{display:block}.custom-dropdown-option{padding:8px 10px;font-size:14px;cursor:pointer;color:var(--modal-ink)}.custom-dropdown-option[aria-selected=true]{background:rgba(96,165,250,0.06)}.custom-dropdown-option:hover{background:rgba(255,255,255,0.02)}.modal-btn,.modal-inline-button,.modal-action{padding:8px 12px;border-radius:10px;border:1px solid transparent;cursor:pointer;font-size:14px;transition:transform var(--transition-speed),box-shadow var(--transition-speed)}.modal-btn:focus{outline:none;box-shadow:0 0 0 var(--focus-ring) rgba(99,102,241,0.12)}.modal-btn:hover{transform:translateY(-1px)}.modal-footer{padding:12px 16px;border-top:1px solid rgba(255,255,255,0.03);display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}.hidden{display:none!important}.small{font-size:13px}.center{text-align:center}.modal-input[type=checkbox],.modal-input[type=radio]{appearance:none;width:16px;height:16px;border:2px solid var(--border);background:var(--input-bg);position:relative;border-radius:4px;display:inline-block;vertical-align:middle}.modal-input[type=checkbox]:checked{background:var(--accent-2)}.modal-input[type=checkbox]:checked::before{content:'\\2713';position:absolute;top:-2px;left:1px;color:#000;font-size:14px}.modal-input[type=radio]{border-radius:50%}.modal-input[type=radio]:checked::before{content:'';position:absolute;top:3px;left:3px;width:8px;height:8px;background:var(--accent-2);border-radius:50%}@media (max-width:560px){.modal-window{width:100%;max-width:100%;border-radius:8px;padding:0}.modal-body{padding:12px}.modal-header{padding:10px 12px}.modal-footer{padding:10px}}";document.head.appendChild(e)}var t=null,n=null,o={};function i(){if(t)return;t=document.createElement("div");t.className="modal-backdrop";t.setAttribute("aria-hidden","true");document.body.appendChild(t);t.addEventListener("click",function(e){e.target===t&&r()});document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("active")&&r()})}function r(e){if(t){t.classList.remove("active");document.documentElement.style.overflow="";o={};n&&(n(e),n=null);setTimeout(function(){t&&(t.innerHTML="")},300)}}function a(e){if("INPUT"===e.tagName)e.classList.add("modal-input");else if("TEXTAREA"===e.tagName)e.classList.add("modal-textarea");else if("SELECT"===e.tagName)e.classList.add("modal-select");else if("BUTTON"===e.tagName)e.classList.add("modal-btn");e.querySelectorAll("input, textarea, select, button").forEach(function(t){a(t)})}function l(e){var t={};return e.querySelectorAll("[id]").forEach(function(e){e.id&&(t[e.id]=e)}),t}function c(e){var t=!0,n=e.querySelectorAll("input, textarea, .custom-dropdown-trigger");return n.forEach(function(e){e.style.borderColor="";if(e.hasAttribute("data-skip-validation"))return;var n=!1;if("INPUT"===e.tagName&&("text"===e.type||"email"===e.type||"url"===e.type))n=e.value.trim()==="";else if(e.classList.contains("custom-dropdown-trigger"))n=(e.dataset.value||"").trim()==="";else if("TEXTAREA"===e.tagName&&(n=e.value.trim()===""),n){e.style.borderColor="var(--danger)",t=!1;var o=function(){e.style.borderColor="",e.removeEventListener("input",o),e.removeEventListener("change",o)};e.addEventListener("input",o),e.addEventListener("change",o)}}),t}function s(e){var t={};return e.querySelectorAll("[id]").forEach(function(e){if(e.id)if("INPUT"===e.tagName){if("checkbox"===e.type||"radio"===e.type)t[e.id]=e.checked;else t[e.id]=e.value}else if("TEXTAREA"===e.tagName||"SELECT"===e.tagName)t[e.id]=e.value;else if(e.classList.contains("custom-dropdown-trigger"))t[e.id]=e.dataset.value||e.textContent}),t}window.showModal=function(e){i();return new Promise(function(o){n=o,o={},t.innerHTML="";var i=document.createElement("div");i.className="modal-window",i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true");var a=document.createElement("div");a.className="modal-header";if(e.header){if("string"==typeof e.header)a.innerHTML=e.header;else if(e.header instanceof HTMLElement&&a.appendChild(e.header)}else{var l=document.createElement("h3");l.className="modal-title",l.textContent=e.title||"",l.id="modal-title-"+Math.random().toString(36).slice(2);var d=document.createElement("button");d.className="modal-close",d.setAttribute("aria-label","Close dialog"),d.innerHTML="&#x2715;",d.addEventListener("click",r),a.appendChild(l),a.appendChild(d),i.setAttribute("aria-labelledby",l.id)}var u=document.createElement("div");u.className="modal-body";if(e.body){if("string"==typeof e.body)u.innerHTML=e.body;else if(e.body instanceof HTMLElement)u.appendChild(e.body);else if(Array.isArray(e.body))u.innerHTML=e.body.join("")}var m=document.createElement("div");m.className="modal-footer";if(e.footer){if("string"==typeof e.footer)m.innerHTML=e.footer;else if(e.footer instanceof HTMLElement)m.appendChild(e.footer);else if(Array.isArray(e.footer))m.innerHTML=e.footer.join("")}else m.innerHTML='<button class="modal-btn">OK</button>';a(a),a(u),a(m),o=l(u);m.querySelectorAll("button").forEach(function(e){var t=e.getAttribute("onclick");if(t){e.removeAttribute("onclick");e.addEventListener("click",function(){if("closeModal()"!==t){if(!c(u))return window.showNotification("Please fill in all required fields."),void 0}try{with(o){eval("(function() { "+t+" })()")}}catch(e){console.error("Error executing button action:",e)}})}else e.addEventListener("click",function(){c(u)?(e=s(u),r({action:e.textContent||e.id||"unknown",values:e})):window.showNotification("Please fill in all required fields.")})}),u.querySelectorAll("[onclick]").forEach(function(e){var t=e.getAttribute("onclick");t&&(e.addEventListener("click",function(){try{with(o){eval("(function() { "+t+" })()")}}catch(e){console.error("Error executing element action:",e)}}),e.removeAttribute("onclick"))}),u.querySelectorAll(".custom-dropdown-trigger").forEach(function(e){var t=JSON.parse(e.dataset.options||"[]");e.addEventListener("click",function(){function n(t){e.textContent=t.label,e.dataset.value=t.value,e.dispatchEvent(new Event("change",{bubbles:!0}))}document.querySelectorAll(".custom-dropdown-portal-menu").forEach(function(e){e.remove()});var o=document.createElement("div");o.className="custom-dropdown-portal-menu active",o.setAttribute("role","listbox");t.forEach(function(t){var i=document.createElement("div");i.className="custom-dropdown-option",i.tabIndex=0,i.dataset.value="object"==typeof t?t.value:t,i.textContent="object"==typeof t?t.label:t,i.setAttribute("role","option"),i.addEventListener("click",function(){n(t),o.remove()}),i.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),i.click())}),o.appendChild(i)}),document.body.appendChild(o);var i=e.getBoundingClientRect();o.style.width=i.width+"px";var r=i.left+window.scrollX,a=r+i.width,l=window.innerWidth;a>l&&(r-=a-l),r<0&&(r=0),o.style.left=r+"px",o.style.top=i.bottom+window.scrollY+"px";function c(e){o.contains(e.target)||e.target===e||(o.remove(),document.removeEventListener("mousedown",c))}document.addEventListener("mousedown",c),window.addEventListener("scroll",function(){document.body.contains(o)&&(e=e.getBoundingClientRect(),r=e.left+window.scrollX,(a=r+e.width)>window.innerWidth&&(r-=a-window.innerWidth),r<0&&(r=0),o.style.left=r+"px",o.style.top=e.bottom+window.scrollY+"px",o.style.width=e.width+"px")},{passive:!0})})}),i.appendChild(a),i.appendChild(u),i.appendChild(m),t.appendChild(i),document.documentElement.style.overflow="hidden",t.classList.add("active");setTimeout(function(){var e=u.querySelector("input, textarea, select, button");e&&e.focus()},100)})};window.modalSubmit=function(){var e=t.querySelector(".modal-body");c(e)?(e=s(e),r({action:"submit",values:e})):window.showNotification("Please fill in all required fields.")};window.closeModal=r;window.createModalElement=function(e,t){var n={el:null,input:null};e=e.toLowerCase();var o=document.createElement("div");o.className="modal-element";if(t.label){var i=document.createElement("label");i.className="modal-label",i.textContent=t.label,o.appendChild(i)}if("message"===e){var a=document.createElement("div");a.className="modal-message",a.textContent=t.text||"",n.el=o,o.appendChild(a);return n}if("input"===e){var l=document.createElement("input");l.className="modal-input",l.type=t.inputType||"text",t.placeholder&&(l.placeholder=t.placeholder),t.value&&(l.value=t.value),t.key&&(l.dataset.modalKey=t.key),t.visibleIf&&(o.dataset.visibleIf=t.visibleIf),o.appendChild(l),n.el=o,n.input=l;return n}if("textarea"===e){var d=document.createElement("textarea");d.className="modal-textarea",d.rows=t.rows||3,t.placeholder&&(d.placeholder=t.placeholder),t.key&&(d.dataset.modalKey=t.key),t.visibleIf&&(o.dataset.visibleIf=t.visibleIf),o.appendChild(d),n.el=o,n.input=d;return n}if("checkbox"===e||"radio"===e){var u=document.createElement("input");u.className="modal-input",u.type=e,t.key&&(u.dataset.modalKey=t.key),t.visibleIf&&(o.dataset.visibleIf=t.visibleIf),o.appendChild(u),n.el=o,n.input=u;return n}if("select"===e){var m=document.createElement("div");m.className="custom-dropdown";var p=document.createElement("div");p.className="custom-dropdown-trigger modal-input",p.tabIndex=0;var h=t.options||[{label:"Select option",value:""}];p.textContent=h[0].label,p.dataset.value=h[0].value,p.dataset.options=JSON.stringify(h),p.addEventListener("click",function(){function e(e){p.textContent=e.label,p.dataset.value=e.value,p.dispatchEvent(new Event("change"))}document.querySelectorAll(".custom-dropdown-portal-menu").forEach(function(e){e.remove()});var t=document.createElement("div");t.className="custom-dropdown-portal-menu active",t.setAttribute("role","listbox");h.forEach(function(n){var o=document.createElement("div");o.className="custom-dropdown-option",o.tabIndex=0,o.dataset.value="object"==typeof n?n.value:n,o.textContent="object"==typeof n?n.label:n,o.setAttribute("role","option"),o.addEventListener("click",function(){e(n),t.remove()}),o.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),o.click())}),t.appendChild(o)}),document.body.appendChild(t);var n=p.getBoundingClientRect();t.style.width=n.width+"px";var o=n.left+window.scrollX,i=o+n.width,r=window.innerWidth;i>r&&(o-=i-r),o<0&&(o=0),t.style.left=o+"px",t.style.top=n.bottom+window.scrollY+"px";function a(e){t.contains(e.target)||e.target===p||(t.remove(),document.removeEventListener("mousedown",a))}document.addEventListener("mousedown",a),window.addEventListener("scroll",function(){document.body.contains(t)&&(n=p.getBoundingClientRect(),o=n.left+window.scrollX,(i=o+n.width)>window.innerWidth&&(o-=i-window.innerWidth),o<0&&(o=0),t.style.left=o+"px",t.style.top=n.bottom+window.scrollY+"px",t.style.width=n.width+"px")},{passive:!0})}),t.key&&(p.dataset.modalKey=t.key),m.appendChild(p),t.visibleIf&&(m.dataset.visibleIf=t.visibleIf),o.appendChild(m),n.el=o,n.input=p;return n}if("button"===e){var f=document.createElement("button");f.type="button",f.className="modal-inline-button modal-btn",f.textContent=t.value||t.label||"Button",t.ariaLabel&&f.setAttribute("aria-label",t.ariaLabel);var g=(t.value||t.label||"").toLowerCase();g.includes("cancel")||g.includes("close")?(f.style.background="#373737",f.style.color="var(--modal-ink)"):(f.style.background="var(--accent-2)",f.style.color="#052027"),"function"==typeof t.onClick&&f.addEventListener("click",t.onClick),t.visibleIf&&(o.dataset.visibleIf=t.visibleIf),o.appendChild(f),n.el=o,n.input=f;return n}if("row"===e){var v=document.createElement("div");v.className="modal-row",t.position&&v.setAttribute("data-position",t.position),(t.children||[]).forEach(function(e){e instanceof Node?v.appendChild(e):e.el&&v.appendChild(e.el)}),n.el=v;return n}return n.el=o,n};i()};
window.handleFormat=function(e){return window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var t=window.noteTextarea.selectionStart,n=window.noteTextarea.selectionEnd,o=window.noteTextarea.value;if(t===n)return window.showNotification("Please select text to "+e+"!"),void 0;var i="italic"===e?"MarkDown (*text*),MarkUp (<i>text</i>)":"underline"===e?"MarkDown (__text__),MarkUp (<u>text</u>)":"bold"===e?"MarkDown (**text**),MarkUp (<b>text</b>)":"MarkDown (```),MarkUp (<code>)",r=[{label:"Select option",value:""},{label:i.split(",")[0],value:"1"},{label:i.split(",")[1],value:"2"}];window.showModal({header:'<div class="modal-title">'+(e[0].toUpperCase()+e.slice(1))+' Text</div>',body:'<label class="modal-label">Choose Format</label><div class="custom-dropdown"><div id="formatType" class="custom-dropdown-trigger modal-input" data-options=\''+JSON.stringify(r)+"'>Select option</div></div>",footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleFormatSubmit(\\''+e+"\\') style=\\\"background: var(--accent-2); color: #052027;\\\">OK</button>"}).then(function(i){if(!i||"OK"!==i.action)return;var r=i.format;if(!r)return;var a=o.slice(t,n),l="";"italic"===e?l="2"===r?"<i>"+a+"</i>":"*"+a+"*":"underline"===e?l="2"===r?"<u>"+a+"</u>":"__"+a+"__":"bold"===e?l="2"===r?"<b>"+a+"</b>":"**"+a+"**":"code"===e&&(l="2"===r?"<code>"+a+"</code>":"```\\n"+a+"\\n```"),window.noteTextarea.value=o.slice(0,t)+l+o.slice(n),window.updateNoteMetadata(),window.showNotification("Text "+e+" applied!")})})()};window.handleFormatSubmit=function(e){var t=window.modalScope.formatType?window.modalScope.formatType.dataset.value:null;t?window.closeModal({action:"OK",format:t,type:e}):window.showNotification("Please select a format!")};
window.handleBulletList=function(){return window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=window.noteTextarea.value;if(e===t)return window.showNotification("Please select text for bullet list!"),void 0;var o=[{label:"Select option",value:""},{label:"MarkDown (- item)",value:"1"},{label:"MarkUp (&lt;ul&gt;&lt;li&gt;)",value:"2"}];window.showModal({header:'<div class="modal-title">Bullet List</div>',body:'<label class="modal-label">Choose Format</label><div class="custom-dropdown"><div id="listFormat" class="custom-dropdown-trigger modal-input" data-options=\''+JSON.stringify(o)+"'>Select option</div></div>",footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleListSubmit(\\'bullet\\') style=\\\"background: var(--accent-2); color: #052027;\\\">OK</button>"}).then(function(o){if(!o||"OK"!==o.action)return;var i=o.format;if(!i)return;var r=n.slice(e,t),a=r.split(/\r?\n/),l="";"2"===i?l="<ul>\\n"+a.map(function(e){return"<li>"+e+"</li>"}).join("\\n")+"\\n</ul>":l=a.map(function(e){return"- "+e}).join("\\n"),window.noteTextarea.value=n.slice(0,e)+l+n.slice(t),window.updateNoteMetadata(),window.showNotification("Bullet list applied!")})})()};window.handleNumberedList=function(){return window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=window.noteTextarea.value;if(e===t)return window.showNotification("Please select text for numbered list!"),void 0;var o=[{label:"Select option",value:""},{label:"MarkDown (1. item)",value:"1"},{label:"MarkUp (&lt;ol&gt;&lt;li&gt;)",value:"2"}];window.showModal({header:'<div class="modal-title">Numbered List</div>',body:'<label class="modal-label">Choose Format</label><div class="custom-dropdown"><div id="listFormat" class="custom-dropdown-trigger modal-input" data-options=\''+JSON.stringify(o)+"'>Select option</div></div>",footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleListSubmit(\\'numbered\\') style=\\\"background: var(--accent-2); color: #052027;\\\">OK</button>"}).then(function(o){if(!o||"OK"!==o.action)return;var i=o.format;if(!i)return;var r=n.slice(e,t),a=r.split(/\r?\n/),l="";"2"===i?l="<ol>\\n"+a.map(function(e){return"<li>"+e+"</li>"}).join("\\n")+"\\n</ol>":l=a.map(function(e,t){return t+1+". "+e}).join("\\n"),window.noteTextarea.value=n.slice(0,e)+l+n.slice(t),window.updateNoteMetadata(),window.showNotification("Numbered list applied!")})})()};window.handleListSubmit=function(e){var t=window.modalScope.listFormat?window.modalScope.listFormat.dataset.value:null;t?window.closeModal({action:"OK",format:t,listType:e}):window.showNotification("Please select a format!")};
window.handleInsertLink=function(){return window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=window.noteTextarea.value,o=[{label:"Select option",value:""},{label:"Markdown",value:"markdown"},{label:"MarkUp",value:"markup"}];window.showModal({header:'<div class="modal-title">Insert Link</div>',body:'<div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">URL</label><input type="url" id="linkUrl" placeholder="Enter URL"></div></div><div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">Link Text</label><input type="text" id="linkText" placeholder="Enter link text"></div></div><div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">Format</label><div class="custom-dropdown"><div id="linkFormat" class="custom-dropdown-trigger modal-input" data-options=\''+JSON.stringify(o)+"'></div></div></div></div>",footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleLinkSubmit()" style="background: var(--accent-2); color: #052027;">Submit</button>'}).then(function(o){if(!o||"submit"!==o.action)return;var i=o.url,r=o.text,a=o.format;if(!i||!r||!a)return;var l="markup"===a?'<a href=\"'+i+'">'+r+"</a>":"["+r+"]("+i+")";window.noteTextarea.value=n.slice(0,e)+l+n.slice(t),window.updateNoteMetadata(),window.showNotification("Link inserted!")})})()};window.handleLinkSubmit=function(){var e=window.modalScope.linkUrl?window.modalScope.linkUrl.value.trim():"",t=window.modalScope.linkText?window.modalScope.linkText.value.trim():"",n=window.modalScope.linkFormat?window.modalScope.linkFormat.dataset.value:"";e&&t&&n?window.closeModal({action:"submit",url:e,text:t,format:n}):window.showNotification("Please fill in all fields!")};
window.handleInsertImage=function(){return window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=window.noteTextarea.value,o=[{label:"Select option",value:""},{label:"Markdown",value:"markdown"},{label:"MarkUp",value:"markup"}];window.showModal({header:'<div class="modal-title">Insert Image</div>',body:'<div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">Image URL</label><input type="url" id="imageUrl" placeholder="Enter image URL"></div></div><div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">Format</label><div class="custom-dropdown"><div id="imageFormat" class="custom-dropdown-trigger modal-input" data-options=\''+JSON.stringify(o)+"'></div></div></div></div>",footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleImageSubmit()" style="background: var(--accent-2); color: #052027;">Insert</button>'}).then(function(o){if(!o||"submit"!==o.action)return;var i=o.url,r=o.format;if(!i||!r)return;var a="markup"===r?'<img src=\"'+i+'" alt="Image" />':"![Image]("+i+")";window.noteTextarea.value=e===t?n+a:n.slice(0,e)+a+n.slice(t),window.updateNoteMetadata(),window.showNotification("Image inserted!")})})()};window.handleImageSubmit=function(){var e=window.modalScope.imageUrl?window.modalScope.imageUrl.value.trim():"",t=window.modalScope.imageFormat?window.modalScope.imageFormat.dataset.value:"";e&&t?window.closeModal({action:"submit",url:e,format:t}):window.showNotification("Please fill in all fields!")};
window.handleUppercase=function(){var e=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=window.noteTextarea.value;if(!n)return;var o=e===t?n.toUpperCase():n.slice(0,e)+n.slice(e,t).toUpperCase()+n.slice(t);window.noteTextarea.value=o,window.updateNoteMetadata(),window.showNotification("Converted to uppercase!")});return"function"==typeof e?e():e};window.handleLowercase=function(){var e=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=window.noteTextarea.value;if(!n)return;var o=e===t?n.toLowerCase():n.slice(0,e)+n.slice(e,t).toLowerCase()+n.slice(t);window.noteTextarea.value=o,window.updateNoteMetadata(),window.showNotification("Converted to lowercase!")});return"function"==typeof e?e():e};
window.handleAlignLeft=function(){window.noteTextarea&&(window.noteTextarea.style.textAlign="left",window.showNotification("Text aligned left!"))};window.handleAlignCenter=function(){window.noteTextarea&&(window.noteTextarea.style.textAlign="center",window.showNotification("Text aligned center!"))};window.handleAlignRight=function(){window.noteTextarea&&(window.noteTextarea.style.textAlign="right",window.showNotification("Text aligned right!"))};
window.increaseIndentation=function(){var e=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd;if(e===t)return window.showNotification("Please select text to indent!"),void 0;var n=window.noteTextarea.value.slice(e,t),o="\\t"+n.replace(/\n/g,"\\n\\t");window.noteTextarea.value=window.noteTextarea.value.slice(0,e)+o+window.noteTextarea.value.slice(t),window.updateNoteMetadata(),window.showNotification("Text indented!")});return"function"==typeof e?e():e};window.decreaseIndentation=function(){var e=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd;if(e===t)return window.showNotification("Please select text to un-indent!"),void 0;var n=window.noteTextarea.value.slice(e,t).split("\n"),o=n.map(function(e){return e.startsWith("\\t")?e.slice(1):e.startsWith("    ")?e.slice(4):e}).join("\\n");window.noteTextarea.value=window.noteTextarea.value.slice(0,e)+o+window.noteTextarea.value.slice(t),window.updateNoteMetadata(),window.showNotification("Indentation removed!")});return"function"==typeof e?e():e};
window.handleSelectAll=function(){window.currentNote&&window.noteTextarea&&(window.noteTextarea.setSelectionRange(0,window.noteTextarea.value.length),window.noteTextarea.blur(),window.showNotification("All text selected!"))};window.handleCopyNote=function(){if(window.currentNote&&window.noteTextarea){var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=e===t?window.noteTextarea.value:window.noteTextarea.value.slice(e,t);navigator.clipboard.writeText(n).then(function(){window.showNotification("Copied to clipboard!")}).catch(function(){window.showNotification("Copy failed (clipboard not available).")})}};window.handleCutNote=function(){if(window.currentNote&&window.noteTextarea){var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=e===t?window.noteTextarea.value:window.noteTextarea.value.slice(e,t);navigator.clipboard.writeText(n).then(function(){window.noteTextarea.value=e===t?"":window.noteTextarea.value.slice(0,e)+window.noteTextarea.value.slice(t),window.noteTextarea.selectionStart=window.noteTextarea.selectionEnd=e,window.updateNoteMetadata(),window.showNotification("Cut to clipboard!")}).catch(function(){window.showNotification("Cut failed (clipboard not available).")})}};window.handleClearNote=function(){var e=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd,n=window.noteTextarea.value;e===t?window.noteTextarea.value="":window.noteTextarea.value=n.slice(0,e)+n.slice(t),window.updateNoteMetadata(),window.showNotification("Note cleared!")});return"function"==typeof e?e():e};
window.checkPassword=function(e,t){window.showModal({header:'<div class="modal-title">Enter Password</div>',body:'<div><label class="modal-label">Please enter the password for this note:</label><input type="password" id="password" class="modal-input"></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleCheckPasswordSubmit()" style="background: var(--accent-2); color: #cacaca;">Submit</button>'}).then(function(n){if(!n||"submit"!==n.action)return;var o=n.password;o===e.password?(t(),window.showNotification("Note unlocked!")):(window.showNotification("Incorrect password!"),window.showModal({header:'<div class="modal-title">Password Recovery</div>',body:'<div><label class="modal-label">Enter DOB (YYYY-MM-DD) or clear note:</label><input type="text" id="dobInput" class="modal-input"></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleRecoverySubmit()" style="background: var(--accent-2); color: #cacaca;">Submit</button>'}).then(function(n){if(!n||"submit"!==n.action)return;var o=n.dobInput;o===window.dob?(t(),window.showNotification("Note unlocked via DOB!")):window.showModal({header:'<div class="modal-title">Clear Note</div>',body:'<div class="modal-label">Incorrect DOB. Clear note to continue?</div>',footer:'<button onclick="closeModal()">No</button><button onclick="handleClearConfirm()" style="background: var(--accent-2); color: #cacaca;">Yes</button>'}).then(function(n){n&&n.confirmed&&(e.content="",e.password="",window.saveNotes(),t(),window.showNotification("Note cleared and unlocked!"))})}))})};window.handleCheckPasswordSubmit=function(){window.closeModal({action:"submit",password:window.modalScope.password.value})};window.handleRecoverySubmit=function(){window.closeModal({action:"submit",dobInput:window.modalScope.dobInput.value})};window.handleClearConfirm=function(){window.closeModal({confirmed:!0})};
window.checkPasswordRequirement=function(){var e=localStorage.getItem("lastPasswordCheck"),t=Date.now();if(!e||t-parseInt(e)>15*60*1e3){window.notes.forEach(function(e){e.password&&e===window.currentNote&&window.checkPassword(e,function(){})}),localStorage.setItem("lastPasswordCheck",t)}};
window.handlePasswordProtect=function(){if(!window.currentNote)return window.showNotification("No note selected"),void 0;if(!window.currentNote.password){var e;if(!window.dob)e=window.showModal({header:'<div class="modal-title">Set Password</div>',body:'<div><label class="modal-label">Enter password:</label><input type="password" id="password" class="modal-input"></div><div><label class="modal-label">Enter DOB (YYYY-MM-DD) for recovery:</label><input type="text" id="dobInput" class="modal-input"></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleSetPasswordDobSubmit()" style="background: var(--accent-2); color: #cacaca;">Set</button>'}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.password,n=e.dobInput;t&&n&&window.showModal({header:'<div class="modal-title">Security Warning</div>',body:'<div class="modal-label">Password is stored in local storage and may be accessible to tech-savvy users. Proceed?</div>',footer:'<button onclick="closeModal()">No</button><button onclick="handleWarningConfirm()" style="background: var(--accent-2); color: #cacaca;">Yes</button>'}).then(function(e){e&&e.confirmed&&(window.currentNote.password=t,localStorage.setItem("dob",n),window.dob=n,window.saveNotes(),window.showNotification("Password set!"))})});else e=window.showModal({header:'<div class="modal-title">Set Password</div>',body:'<div><label class="modal-label">Enter password:</label><input type="password" id="password" class="modal-input"></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleSetPasswordSubmit()" style="background: var(--accent-2); color: #cacaca;">Set</button>'}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.password;t&&window.showModal({header:'<div class="modal-title">Security Warning</div>',body:'<div class="modal-label">Password is stored in local storage and may be accessible to tech-savvy users. Proceed?</div>',footer:'<button onclick="closeModal()">No</button><button onclick="handleWarningConfirm()" style="background: var(--accent-2); color: #cacaca;">Yes</button>'}).then(function(e){e&&e.confirmed&&(window.currentNote.password=t,window.saveNotes(),window.showNotification("Password set!"))})}}else window.showModal({header:'<div class="modal-title">Password Options</div>',body:'<div><label class="modal-label">Remove or change password? Enter "remove" or "change":</label><input type="text" id="action" class="modal-input"></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleActionSubmit()" style="background: var(--accent-2); color: #cacaca;">Submit</button>'}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.action;if("remove"===t)window.showModal({header:'<div class="modal-title">Remove Password</div>',body:'<div><label class="modal-label">Enter current password:</label><input type="password" id="password" class="modal-input"></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleRemovePasswordSubmit()" style="background: var(--accent-2); color: #cacaca;">Remove</button>'}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.password;t===window.currentNote.password?(window.currentNote.password="",window.saveNotes(),window.showNotification("Password removed!")):window.showNotification("Incorrect password!")});else if("change"===t)window.showModal({header:'<div class="modal-title">Change Password</div>',body:'<div><label class="modal-label">Enter current password:</label><input type="password" id="oldPassword" class="modal-input"></div><div><label class="modal-label">Enter new password:</label><input type="password" id="newPassword" class="modal-input"></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleChangePasswordSubmit()" style="background: var(--accent-2); color: #cacaca;">Change</button>'}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.oldPassword,n=e.newPassword;t===window.currentNote.password?(window.currentNote.password=n,window.saveNotes(),window.showNotification("Password changed!")):window.showNotification("Incorrect current password!")})})};window.handleSetPasswordDobSubmit=function(){window.closeModal({action:"submit",password:window.modalScope.password.value,dobInput:window.modalScope.dobInput.value})};window.handleSetPasswordSubmit=function(){window.closeModal({action:"submit",password:window.modalScope.password.value})};window.handleWarningConfirm=function(){window.closeModal({confirmed:!0})};window.handleActionSubmit=function(){window.closeModal({action:"submit",action:window.modalScope.action.value})};window.handleRemovePasswordSubmit=function(){window.closeModal({action:"submit",password:window.modalScope.password.value})};window.handleChangePasswordSubmit=function(){window.closeModal({action:"submit",oldPassword:window.modalScope.oldPassword.value,newPassword:window.modalScope.newPassword.value})};
window.handleRename=function(){var e=window.preserveSelection(function(){if(!window.currentNote)return window.showNotification("No note selected"),void 0;var e=window.currentNote.title||"",t=window.currentNote.extension||"";window.showModal({header:'<div class="modal-title">Rename Note</div>',body:'<div style="display:flex;gap:10px;align-items:center;"><div style="flex:1;"><label class="modal-label">Name</label><input type="text" id="newTitle" placeholder="Enter Name" value=\"'+e.replace(/"/g,'&quot;')+'\"></div></div><div style="display:flex;gap:10px;align-items:center;"><div style="flex:1;"><label class="modal-label">Extension</label><input type="text" id="newExtension" placeholder="Enter Extension" value=\"'+t.replace(/"/g,'&quot;')+'\"></div></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleRenameSubmit()" style="background:var(--accent-2);color:#052027;">OK</button>'}).then(function(n){if(!n||"OK"!==n.action)return;var o=String(n.newTitle||"").trim(),i=String(n.newExtension||"").trim();if(!o&&!i)return;o=o||e,i=i||t.replace(/^\\./,"").toLowerCase(),window.currentNote.title=o,window.currentNote.extension=i,window.currentNote.lastEdited=new Date().toISOString();var r=window.notes.findIndex(function(e){return e.id===window.currentNote.id});-1!==r&&(window.notes[r].title=o,window.notes[r].extension=window.currentNote.extension,window.notes[r].lastEdited=window.currentNote.lastEdited),window.updateNoteMetadata(),window.updateDocumentInfo(),window.populateNoteList(),window.showNotification("Note updated!")})});return"function"==typeof e?e():e};window.handleRenameSubmit=function(){window.closeModal({action:"OK",newTitle:window.modalScope.newTitle?window.modalScope.newTitle.value:"",newExtension:window.modalScope.newExtension?window.modalScope.newExtension.value:""})};
window.handleDownload=function(){if(!window.currentNote||!window.noteTextarea)return;var e=(window.currentNote.title||"note")+"."+(window.currentNote.extension||"txt").replace(/"/g,'&quot;');window.showModal({header:'<div class="modal-title">Download Note</div>',body:'<div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">Filename</label><input type="text" id="fileName" placeholder="Enter filename including extension" value=\"'+e+'\"></div></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleDownloadSubmit()" data-skip-validation style="background: var(--accent-2); color: #052027;">Download</button>'}).then(function(e){if(!e||"Download"!==e.action)return;var t=String(e.fileName||"").trim();if(!t)return;t=t.replace(/\0/g,"").replace(/[/\\]+/g,"").replace(/["'<>:|?*]+/g,"");var n=t.split("."),o=n.length>1?(n.pop()||"txt").toLowerCase():"txt",i=n.join(".")||"note",r={txt:"text/plain; charset=utf-8",text:"text/plain; charset=utf-8",md:"text/markdown; charset=utf-8",markdown:"text/markdown; charset=utf-8",csv:"text/csv; charset=utf-8",log:"text/plain; charset=utf-8",ini:"text/plain; charset=utf-8",conf:"text/plain; charset=utf-8",env:"text/plain; charset=utf-8",html:"text/html; charset=utf-8",htm:"text/html; charset=utf-8",css:"text/css; charset=utf-8",js:"application/javascript; charset=utf-8",mjs:"text/javascript; charset=utf-8",ts:"application/typescript; charset=utf-8",jsx:"text/jsx; charset=utf-8",tsx:"text/tsx; charset=utf-8",json:"application/json; charset=utf-8",xml:"application/xml; charset=utf-8",yaml:"text/yaml; charset=utf-8",yml:"text/yaml; charset=utf-8",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",gif:"image/gif",svg:"image/svg+xml; charset=utf-8",ico:"image/vnd.microsoft.icon",woff:"font/woff",woff2:"font/woff2",ttf:"font/ttf",otf:"font/otf",mp3:"audio/mpeg",m4a:"audio/mp4",wav:"audio/wav",ogg:"audio/ogg",flac:"audio/flac",mp4:"video/mp4",m4v:"video/x-m4v",mov:"video/quicktime",webm:"video/webm",mkv:"video/x-matroska",avi:"video/x-msvideo",zip:"application/zip",tar:"application/x-tar",gz:"application/gzip",tgz:"application/gzip",bz2:"application/x-bzip2",xz:"application/x-xz",rar:"application/vnd.rar","7z":"application/x-7z-compressed",pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet",odp:"application/vnd.oasis.opendocument.presentation",epub:"application/epub+zip",exe:"application/vnd.microsoft.portable-executable",dll:"application/octet-stream",bin:"application/octet-stream",wasm:"application/wasm",sh:"application/x-sh",bash:"application/x-sh",ps1:"text/plain; charset=utf-8",bat:"application/x-msdownload",sql:"text/x-sql; charset=utf-8",rtf:"application/rtf",svgz:"image/svg+xml; charset=utf-8",heic:"image/heic",heif:"image/heif"},a=r[o]||(/\.(jpg|jpeg|png|gif|webp|svg|ico)$/i.test(o)?"image/"+o:"application/octet-stream"),l=["text/plain","text/markdown","text/csv","text/html","application/json","application/javascript","application/xml","text/yaml","text/jsx","text/tsx"];l.some(function(e){return a.indexOf(e)===0})&&!/charset=/.test(a)&&(a+="; charset=utf-8");var c=i+"."+o,d=new Blob([window.noteTextarea.value],{type:a}),u=URL.createObjectURL(d),m=document.createElement("a");m.href=u,m.download=c,document.body.appendChild(m),m.click(),m.remove(),setTimeout(function(){URL.revokeObjectURL(u)},1500),window.showNotification("Note downloaded as "+c+"!")})};window.handleDownloadSubmit=function(){var e=window.modalScope.fileName?window.modalScope.fileName.value:"";window.closeModal({action:"Download",fileName:e})};
window.handleFindReplace=function(){if(!window.currentNote||!window.noteTextarea)return;window.showModal({header:'<div class="modal-title">Find and Replace</div>',body:'<div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">Find</label><input type="text" id="findText" placeholder="Enter text to find"></div></div><div style="display: flex; gap: 10px; align-items: center;"><div style="flex: 1;"><label class="modal-label">Replace</label><input type="text" id="replaceText" placeholder="Enter replacement text" data-skip-validation></div></div><div style="display: flex; align-items: center; margin-top: 8px;"><input type="checkbox" id="caseSensitive" style="color: var(--accent-2);margin-right: 6px"><label for="caseSensitive" class="modal-label">Case sensitive</label></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleFindReplaceSubmit()" style="background: var(--accent-2); color: #052027;">Replace</button>'}).then(function(e){if(!e||"Replace"!==e.action)return;var t=e.findText.trim(),n=e.replaceText,o=e.caseSensitive===!0;if(!t)return window.showNotification("Please enter text to find!"),void 0;try{var i=t.replace(/[.*+?^${}()|[\]\\]/g,"\\\\$&"),r=new RegExp(i,o?"g":"gi");window.noteTextarea.value=window.noteTextarea.value.replace(r,n),window.updateNoteMetadata(),window.showNotification("Text replaced!")}catch(e){window.showNotification("Error in find and replace!")}})};window.handleFindReplaceSubmit=function(){var e=window.modalScope.findText?window.modalScope.findText.value:"",t=window.modalScope.replaceText?window.modalScope.replaceText.value:"",n=window.modalScope.caseSensitive?window.modalScope.caseSensitive.checked:!1;window.closeModal({action:"Replace",findText:e,replaceText:t,caseSensitive:n})};
window.MD5=function(e){var t=function(e){for(var t,n="0123456789ABCDEF",o="",i=0;i<e.length;i++)t=e.charCodeAt(i),o+=n.charAt(t>>>4&15)+n.charAt(15&t);return o}(function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(function(e,t){e[t>>5]|=128<<t%32,e[14+((t+64)>>>9<<4)]=t;for(var n=1732584193,o=-271733879,i=-1732584194,r=271733878,a=0;a<e.length;a+=16){var l=n,c=o,s=i,d=r;o=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&n)|(~t&o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&o)|(n&~o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+(t^n^o)+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+(n^(t|~o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&n)|(~t&o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&n)|(~t&o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&n)|(~t&o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&n)|(~t&o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&o)|(n&~o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&o)|(n&~o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&o)|(n&~o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+((t&o)|(n&~o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+(t^n^o)+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+(t^n^o)+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+(t^n^o)+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+(t^n^o)+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r=function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){return function(e,t,n,o,i,r,a){var l=((e<<5|e>>>27)+(n^(t|~o))+i+a)&4294967295;return(l<<r|l>>>(32-r))+t&4294967295}(e,t,n,o,i,r,a)}(e,t,n,o,i,r,a)}(e,o,i,r,n=function(e,t){var n=(65535&e)+(65535&t);return((e>>16)+(t>>16)+(n>>16)<<16|65535&n)}(n,l),o=function(e,t){return function(e,t){var n=(65535&e)+(65535&t);return((e>>16)+(t>>16)+(n>>16)<<16|65535&n)}(o,c),i=function(e,t){var n=(65535&e)+(65535&t);return((e>>16)+(t>>16)+(n>>16)<<16|65535&n)}(i,s),r=function(e,t){var n=(65535&e)+(65535&t);return((e>>16)+(t>>16)+(n>>16)<<16|65535&n)}(r,d)}return[n,o,i,r]}(function(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}(e),8*e.length))));return t.toLowerCase()};window.MD5Hash=function(){window.noteTextarea&&(window.noteTextarea.value=window.MD5(window.noteTextarea.value),window.showNotification("MD5 Generated!"))};
window.reverseText=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd;if(e===t)window.noteTextarea.value=window.noteTextarea.value.split("").reverse().join("");else{var n=window.noteTextarea.value,o=n.substring(e,t),i=o.split("").reverse().join("");window.noteTextarea.value=n.substring(0,e)+i+n.substring(t)}window.updateNoteMetadata(),window.showNotification("Text reversed!")});window.reverseWords=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd;if(e===t)window.noteTextarea.value=window.noteTextarea.value.split(/\s+/).reverse().join(" ");else{var n=window.noteTextarea.value,o=n.substring(e,t),i=o.split(/\s+/).reverse().join(" ");window.noteTextarea.value=n.substring(0,e)+i+n.substring(t)}window.updateNoteMetadata(),window.showNotification("Words reversed!")});window.capitalizeWords=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd;if(e===t)window.noteTextarea.value=window.noteTextarea.value.replace(/\b\w+/g,function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()});else{var n=window.noteTextarea.value,o=n.substring(e,t),i=o.replace(/\b\w+/g,function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()});window.noteTextarea.value=n.substring(0,e)+i+n.substring(t)}window.updateNoteMetadata(),window.showNotification("Words capitalized!")});window.capitalizeSentences=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;var e=window.noteTextarea.selectionStart,t=window.noteTextarea.selectionEnd;if(e===t)window.noteTextarea.value=window.noteTextarea.value.toLowerCase().replace(/(^\s*[a-z])|([.!?]\s*[a-z])/g,function(e){return e.toUpperCase()});else{var n=window.noteTextarea.value,o=n.substring(e,t).toLowerCase(),i=o.replace(/(^\s*[a-z])|([.!?]\s*[a-z])/g,function(e){return e.toUpperCase()});window.noteTextarea.value=n.substring(0,e)+i+n.substring(t)}window.updateNoteMetadata(),window.showNotification("Sentences capitalized!")});
window.handlePattern=function(){if(!window.currentNote||!window.noteTextarea)return;window.showModal({header:'<div class="modal-title">Replace Between Delimiters</div>',body:'<style>.modal-btn.active { background: var(--accent-2); color: #cacaca; }</style><div><label class="modal-label">Start delimiter</label><input type="text" id="startDelim" placeholder="Start delimiter (required)"></div><div><label class="modal-label">End delimiter</label><input type="text" id="endDelim" placeholder="End delimiter (required)"></div><div style="display:flex;align-items:center;gap:8px;margin-top:6px;"><input type="checkbox" id="includeDelims"><label for="includeDelims" class="modal-label">Include delimiters in replacement</label></div><div><label class="modal-label">Replacement text</label><input type="text" id="replaceText" placeholder="Replacement text" data-skip-validation></div><div style="margin-top:8px;font-weight:600;">Which instances to replace?</div><div style="display:flex;gap:8px;margin-top:4px;"><button type="button" id="allMode" class="modal-btn active" data-mode="all">All</button><button type="button" id="singleMode" class="modal-btn" data-mode="single">Single</button><button type="button" id="rangeMode" class="modal-btn" data-mode="range">Range</button></div><div id="singleContainer" style="display:none;margin-top:6px;"><label class="modal-label">Instance number (1-based)</label><input type="number" id="singleInstance" min="1" value="1"></div><div id="rangeContainer" style="display:none;margin-top:6px;display:flex;gap:8px;"><div><label class="modal-label">From (1-based)</label><input type="number" id="rangeFrom" min="1" value="1"></div><div><label class="modal-label">To (1-based)</label><input type="number" id="rangeTo" min="1" value="1"></div></div><div id="matchInfo" style="font-size:13px;color:var(--modal-muted);margin-top:6px;">Matches: 0</div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handlePatternSubmit()" style="background: var(--accent-2); color: #052027;">Replace</button>'}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.startDelim,n=e.endDelim,o=e.includeDelims,i=e.replaceText,r=e.mode,a=e.singleInstance,l=e.rangeFrom,c=e.rangeTo;if(!t)return window.showNotification("Start delimiter required"),void 0;if(!n)return window.showNotification("End delimiter required"),void 0;var s=window.noteTextarea.value,u=function(e,t,n){var o=[];if(!t||!n)return o;var i=t.length,r=n.length,a=[];e=0;while(e<s.length){if(s.substr(e,i)===t){a.push(e);e+=i;continue}if(s.substr(e,r)===n){if(a.length>0){var l=a.pop(),c=e+r;o.push({startIndex:l,endIndex:c})}e+=r;continue}e++}return o.sort(function(e,t){return e.startIndex-t.startIndex})}(s,t,n);if(0===u.length)return window.showNotification("No matches found"),void 0;var d=1,f=u.length;if("single"===r){var p=parseInt(a,10);if(isNaN(p)||p<1)return window.showNotification("Invalid instance number"),void 0;d=f=Math.min(Math.max(p,1),u.length)}else if("range"===r){var h=parseInt(l,10),g=parseInt(c,10);if(isNaN(h)||isNaN(g))return window.showNotification("Invalid range"),void 0;d=Math.min(Math.max(h,1),u.length),f=Math.min(Math.max(g,d),u.length)}try{var v=s;for(var m=u.length-1;m>=0;m--){var y=u[m],b=m+1;if(b<d||b>f)continue;var w=v.slice(0,y.startIndex),x=v.slice(y.endIndex),k="";o?k=i:k=t+i+n,v=w+k+x}window.noteTextarea.value=v,"function"==typeof window.updateNoteMetadata&&window.updateNoteMetadata();var L=Math.max(0,Math.min(f,u.length)-d+1);window.showNotification("Replacement done! ("+L+" instance(s) replaced)")}catch(e){console.error("Replacement error",e),window.showNotification("Replacement failed  see console")}})};window.handlePatternSubmit=function(){var e=window.modalScope.startDelim?window.modalScope.startDelim.value.trim():"",t=window.modalScope.endDelim?window.modalScope.endDelim.value.trim():"",n=window.modalScope.includeDelims?window.modalScope.includeDelims.checked:!1,o=window.modalScope.replaceText?window.modalScope.replaceText.value:"",i=window.modalScope.allMode&&window.modalScope.allMode.classList.contains("active")?"all":window.modalScope.singleMode&&window.modalScope.singleMode.classList.contains("active")?"single":"range",r=window.modalScope.singleInstance?window.modalScope.singleInstance.value:"1",a=window.modalScope.rangeFrom?window.modalScope.rangeFrom.value:"1",l=window.modalScope.rangeTo?window.modalScope.rangeTo.value:"1";window.closeModal({action:"submit",startDelim:e,endDelim:t,includeDelims:n,replaceText:o,mode:i,singleInstance:r,rangeFrom:a,rangeTo:l})};document.addEventListener("click",function(e){if(window.modalScope){var t=e.target&&e.target.id;if("allMode"===t||"singleMode"===t||"rangeMode"===t){["allMode","singleMode","rangeMode"].forEach(function(e){window.modalScope[e]&&window.modalScope[e].classList.remove("active")});e.target.classList.add("active");window.modalScope.singleContainer&&(window.modalScope.singleContainer.style.display="singleMode"===t?"block":"none");window.modalScope.rangeContainer&&(window.modalScope.rangeContainer.style.display="rangeMode"===t?"flex":"none")}}});document.addEventListener("input",function(e){if(window.modalScope){var t=e.target&&e.target.id;if("startDelim"===t||"endDelim"===t){var n=window.modalScope.startDelim?window.modalScope.startDelim.value:"",o=window.modalScope.endDelim?window.modalScope.endDelim.value:"";if(!n||!o)return window.modalScope.matchInfo&&(window.modalScope.matchInfo.textContent="Matches: 0"),void 0;var i=function(e,t,n){var o=[];if(!t||!n)return o;var i=t.length,r=n.length,a=[];e=0;while(e<e.length){if(e.substr(e,i)===t){a.push(e);e+=i;continue}if(e.substr(e,r)===n){if(a.length>0){var l=a.pop(),c=e+r;o.push({startIndex:l,endIndex:c})}e+=r;continue}e++}return o.sort(function(e,t){return e.startIndex-t.startIndex})}(window.noteTextarea.value,n,o);window.modalScope.matchInfo&&(window.modalScope.matchInfo.textContent="Matches: "+i.length);if(i.length){window.modalScope.rangeFrom&&(window.modalScope.rangeFrom.value="1");window.modalScope.rangeTo&&(window.modalScope.rangeTo.value=String(i.length));window.modalScope.singleInstance&&(window.modalScope.singleInstance.value="1")}}}});
window.handleAdd=function(){if(!window.currentNote||!window.noteTextarea)return;window.showModal({header:'<div class="modal-title">Add Text to Lines</div>',body:'<div style="display:flex;flex-direction:column;gap:10px;"><div><label class="modal-label">Insert text</label><input type="text" id="insertText" class="modal-input" placeholder="Text to insert (use %L for line number, %N for new line)" data-skip-validation></div><div><label class="modal-label">Insert position</label><div class="custom-dropdown"><div id="insertPosition" class="custom-dropdown-trigger modal-input" data-options=\'[{"label":"Insert at start of line","value":"start"},{"label":"Insert at end of line","value":"end"},{"label":"Insert at specific column","value":"column"}]\' data-value="start">Insert at start of line</div></div></div><div id="colContainer" style="display:none"><label class="modal-label">Column number</label><input type="number" id="columnNumber" class="modal-input" placeholder="Column number (1-based)" min="1"></div></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleAddSubmit()" style="background: var(--accent-2); color: #cacaca;">Add</button>',html:!0}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.insertText,n=e.insertPosition,o=e.columnNumber,i=parseInt(o,10)||1,r=window.noteTextarea.value.split("\\n"),a="";for(var l=0;l<r.length;l++){var c=r[l],s=t.replace(/%L/g,String(l+1)).replace(/%N/g,"\\n");"start"===n?c=s+c:"end"===n?c=c+s:"column"===n&&(c=c.length<i?c.padEnd(i," "):c,c=c.slice(0,i)+s+c.slice(i));a+=c+(l<r.length-1?"\\n":"")}window.noteTextarea.value=a,"function"==typeof window.updateNoteMetadata&&window.updateNoteMetadata(),"function"==typeof window.updatecounts&&window.updatecounts(),window.showNotification("Text added successfully!")})};window.handleAddSubmit=function(){var e=window.modalScope.insertText?window.modalScope.insertText.value:"",t=window.modalScope.insertPosition?window.modalScope.insertPosition.dataset.value:"start",n=window.modalScope.columnNumber?window.modalScope.columnNumber.value:"";window.closeModal({action:"submit",insertText:e,insertPosition:t,columnNumber:n})};document.addEventListener("click",function(e){if(window.modalScope){var t=window.modalScope.insertPosition;if(!t)return;var n=t.dataset.value||"start",o=window.modalScope.colContainer;o&&(o.style.display="column"===n?"block":"none")}});
window.handleCleanupText=function(){if(!window.currentNote||!window.noteTextarea)return;window.showModal({header:'<div class="modal-title">Cleanup Text</div>',body:'<div style="display:flex;flex-direction:column;gap:10px;"><div><label class="modal-label">Choose Cleanup Style</label><div class="custom-dropdown"><div id="cleanupStyle" class="custom-dropdown-trigger modal-input" data-options=\'[{"label":"Select CleanUp Style","value":""},{"label":"Remove Linebreaks","value":"remove_linebreaks"},{"label":"Remove Parabreaks","value":"remove_parabreaks"},{"label":"Remove Both Line & Para Breaks","value":"remove_both"},{"label":"Whitespace Cleanup","value":"whitespace_cleanup"},{"label":"Trim Columns","value":"trim_columns"},{"label":"Tidy Lines","value":"tidy_lines"}]\' data-value="">Select CleanUp Style</div></div></div><div id="trimContainer" style="display:none;flex-direction:column;gap:10px;"><div><label class="modal-label">Number of Columns</label><input type="number" id="trimNumber" class="modal-input" value="1" min="1"></div><div><label class="modal-label">Trim Side</label><div class="custom-dropdown"><div id="trimSide" class="custom-dropdown-trigger modal-input" data-options=\'[{"label":"Left","value":"left"},{"label":"Right","value":"right"}]\' data-value="left">Left</div></div></div></div></div>',footer:'<button onclick="closeModal()">Cancel</button><button onclick="handleCleanupSubmit()" style="background: var(--accent-2); color: #cacaca;">Cleanup</button>',html:!0}).then(function(e){if(!e||"submit"!==e.action)return;var t=e.cleanupStyle,n=e.trimNumber,o=e.trimSide,i=window.noteTextarea.value;if("remove_linebreaks"===t)i=i.replace(/\r\n|\r|\n/g," ");else if("remove_parabreaks"===t)i=i.replace(/\n{3,}/g,"\\n\\n");else if("remove_both"===t)i=i.replace(/\r\n|\r|\n/g," ").replace(/\s+/g," ").trim();else if("whitespace_cleanup"===t)i=i.replace(/\t+/g," ").replace(/ {2,}/g," ").replace(/\n{3,}/g,"\\n\\n").replace(/^\n+|\n+$/g,"");else if("trim_columns"===t){var r=parseInt(n,10)||0;i=i.split("\\n").map(function(e){return"left"===o?e.slice(r):"right"===o?e.slice(0,-r):e}).join("\\n")}else"tidy_lines"===t&&(i=i.split("\\n").map(function(e){return e.trim()}).join("\\n"));window.noteTextarea.value=i,"function"==typeof window.updateNoteMetadata&&window.updateNoteMetadata(),window.showNotification("Text cleaned successfully!")})};window.handleCleanupSubmit=function(){var e=window.modalScope.cleanupStyle?window.modalScope.cleanupStyle.dataset.value:"",t=window.modalScope.trimNumber?window.modalScope.trimNumber.value:"1",n=window.modalScope.trimSide?window.modalScope.trimSide.dataset.value:"left";e?window.closeModal({action:"submit",cleanupStyle:e,trimNumber:t,trimSide:n}):window.showNotification("Please select a cleanup style!")};document.addEventListener("click",function(e){if(window.modalScope){var t=window.modalScope.cleanupStyle;if(!t)return;var n=t.dataset.value||"",o=window.modalScope.trimContainer;o&&(o.style.display="trim_columns"===n?"flex":"none")}});
!function(){var e={maxEntries:50,powerWindowMs:3e3,coalesceMs:500,memoryBudgetBytes:2e5,persistKey:"myapp_undo_data_v5",persistTTL:864e5,imeDebounce:50};function t(e){try{return new Blob([JSON.stringify(e)]).size}catch(t){return JSON.stringify(e).length}}function n(){return Date.now()}function o(e,t){return e&&t&&e.value===t.value&&e.start===t.start&&e.end===t.end}function i(e,t,n){return Math.max(t,Math.min(n,e))}function r(e){if(!e)return{start:0,end:0,dir:"forward"};try{return{start:e.selectionStart||0,end:e.selectionEnd||0,dir:e.selectionDirection||"forward"}}catch(t){return{start:0,end:0,dir:"forward"}}}function a(e,t){if(!e||!t)return;try{e.setSelectionRange(t.start,t.end,t.dir)}catch(n){}}function l(e){return{value:e.value,start:(t=e).selectionStart||0,end:t.selectionEnd||0,dir:t.selectionDirection||"forward",ts:n()};var t}function c(e,t){if(!e||!t)return!1;var n=e.value||"",o=t.value||"";if(Math.abs(n.length-o.length)>5)return!1;for(var i=0,r=0,a=0;r<n.length||a<o.length;){if(n[r]!==o[a]){if(i>2)return!1;i++,r++,a++}else r++,a++}return!0}function s(e,t){var n=(65535&e)+(65535&t);return((e>>16)+(t>>16)+(n>>16)<<16|65535&n)}function u(e,t){return e<<t|e>>>32-t}function d(e,t,n,o,i,r){return s(u(s(s(t,e),s(o,r)),i),n)}function p(e,t,n,o,i,r,a){return d((t&n)|(~t&o),e,t,i,r,a)}function h(e,t,n,o,i,r,a){return d((t&o)|(n&~o),e,t,i,r,a)}function f(e,t,n,o,i,r,a){return d(t^n^o,e,t,i,r,a)}function g(e,t,n,o,i,r,a){return d(n^(t|~o),e,t,i,r,a)}function v(){var e=document.getElementById("noteTextarea")||document.querySelector("textarea");if(!e)return null;window.__HistoryManagerInstance&&window.__HistoryManagerInstance.destroy();window.__HistoryManagerInstance=new m(e);window.performUndo=function(){return window.__HistoryManagerInstance.performUndo()};window.performRedo=function(){return window.__HistoryManagerInstance.performRedo()};window.clearUndoHistory=function(){return window.__HistoryManagerInstance.clear()};window.recordState=function(e){return window.__HistoryManagerInstance.recordNow(e)};window.serializeUndoHistory=function(){return window.__HistoryManagerInstance.serialize()};window.deserializeUndoHistory=function(e){return window.__HistoryManagerInstance.deserialize(e)};return window.__HistoryManagerInstance}var m=function(e,t){this.opts=Object.assign({},e,t||{}),this.maxEntries=this.opts.maxEntries,this.powerWindowMs=this.opts.powerWindowMs,this.coalesceMs=this.opts.coalesceMs,this.persistKey=this.opts.persistKey,this.persistTTL=this.opts.persistTTL,this.imeDebounce=this.opts.imeDebounce,this.target=null,this._onInput=this._onInput.bind(this),this._onCutPaste=this._onCutPaste.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onCompositionStart=this._onCompositionStart.bind(this),this._onCompositionEnd=this._onCompositionEnd.bind(this),this._observer=null,this._composition=!1,this._coalesceTimer=null,this._undo=[],this._redo=[],this._suppress=!1,this._wrapped={},this._lastUndoClick=0,this._lastRedoClick=0,this._undoPower=1,this._redoPower=1,e&&this.init(e)};if(m.prototype.init=function(e){if(!e||"TEXTAREA"!==e.tagName.toUpperCase())throw new Error("target must be textarea");this.destroy(),this.target=e,this._loadPersist(),this._installListeners(),this._wrapProgrammatics(),this._commitInitial()},m.prototype.destroy=function(){this._uninstallListeners(),this._unwrapProgrammatics(),this._disconnectObserver(),this._undo=[],this._redo=[],this.target=null,this._suppress=!1},m.prototype.performUndo=function(){if(!this.target)return;if(this._undo.length<=1)return this._notify("Nothing to undo"),void 0;var e=Math.min(this._undoPower,this._undo.length-1);this._suppress=!0;for(var t=0;t<e;t++){var n=this._undo.pop();this._redo.push(n)}var o=this._undo[this._undo.length-1];o&&this._applyFrame(o),this._suppress=!1,this._notify("Undo performed ("+e+" step(s))"),this._persist()},m.prototype.performRedo=function(){if(!this.target)return;if(0===this._redo.length)return this._notify("Nothing to redo"),void 0;var e=Math.min(this._redoPower,this._redo.length);this._suppress=!0;for(var t=0;t<e;t++){var n=this._redo.pop();this._undo.push(n)}var o=this._undo[this._undo.length-1];o&&this._applyFrame(o),this._suppress=!1,this._notify("Redo performed ("+e+" step(s))"),this._persist()},m.prototype.clear=function(){this._undo=[],this._redo=[],this._persist()},m.prototype.recordNow=function(e){this.target&&this._commitImmediate(e||"manual")},m.prototype.serialize=function(){return JSON.stringify({undo:this._undo,redo:this._redo,ts:n()})},m.prototype.deserialize=function(e){try{var t="string"==typeof e?JSON.parse(e):e;return this._undo=t.undo||[],this._redo=t.redo||[],this._trim(),this._persist(),!0}catch(n){return!1}},m.prototype._notify=function(e){try{window.showNotification&&window.showNotification(e)}catch(t){console.log(e)}},m.prototype._applyFrame=function(e){if(!this.target)return;this._suppress=!0,this.target.value=e.value,a(this.target,e),window.currentNote&&(window.currentNote.content=e.value),"function"==typeof window.updateNoteMetadata&&window.updateNoteMetadata(),this._suppress=!1},m.prototype._createFrame=function(e){return{value:e.value,start:e.start,end:e.end,dir:e.dir,ts:e.ts}},m.prototype._undoPush=function(e){this._undo.length&&o(this._undo[this._undo.length-1],e)||(this._undo.push(e),this._trim(),this._persist())},m.prototype._redoPush=function(e){this._redo.length&&o(this._redo[this._redo.length-1],e)||(this._redo.push(e),this._trim(),this._persist())},m.prototype._trim=function(){var e=this.maxEntries;for(;this._undo.length>e;)this._undo.shift();for(;this._redo.length>e;)this._redo.shift();if(this.opts.memoryBudgetBytes){for(var t=t({undo:this._undo,redo:this._redo});t>this.opts.memoryBudgetBytes&&this._undo.length>1;)this._undo.shift(),t=t({undo:this._undo,redo:this._redo})}},m.prototype._persist=function(){try{localStorage.setItem(this.persistKey,JSON.stringify({undo:this._undo,redo:this._redo,expires:n()+this.persistTTL}))}catch(e){}},m.prototype._loadPersist=function(){try{var e=localStorage.getItem(this.persistKey);if(e){var t=JSON.parse(e);t.expires&&t.expires>n()&&(this._undo=(t.undo||[]).slice(-this.maxEntries),this._redo=(t.redo||[]).slice(-this.maxEntries))}}catch(e){}},m.prototype._commitInitial=function(){this.target&&(e=l(this.target),this._undo=[this._createFrame(e)],this._redo=[],this._persist());var e},m.prototype._installListeners=function(){if(this.target){this.target.addEventListener("input",this._onInput),this.target.addEventListener("paste",this._onCutPaste),this.target.addEventListener("cut",this._onCutPaste),this.target.addEventListener("keydown",this._onKeydown),this.target.addEventListener("compositionstart",this._onCompositionStart),this.target.addEventListener("compositionend",this._onCompositionEnd),this._observer=new MutationObserver(function(){this._suppress||this._scheduleCommit()}.bind(this)),this._observer.observe(this.target,{characterData:!0,childList:!0,subtree:!0}),window.undoBtn&&window.undoBtn.addEventListener("click",function(){var e=n();e-this._lastUndoClick<=this.powerWindowMs?this._undoPower=i(this._undoPower+1,1,this.maxEntries):this._undoPower=1,this._lastUndoClick=e,this._redoPower=1,this._lastRedoClick=0,this.performUndo()}.bind(this)),window.redoBtn&&window.redoBtn.addEventListener("click",function(){var e=n();e-this._lastRedoClick<=this.powerWindowMs?this._redoPower=i(this._redoPower+1,1,this.maxEntries):this._redoPower=1,this._lastRedoClick=e,this._undoPower=1,this._lastUndoClick=0,this.performRedo()}.bind(this))}},m.prototype._uninstallListeners=function(){if(this.target)try{this.target.removeEventListener("input",this._onInput),this.target.removeEventListener("paste",this._onCutPaste),this.target.removeEventListener("cut",this._onCutPaste),this.target.removeEventListener("keydown",this._onKeydown),this.target.removeEventListener("compositionstart",this._onCompositionStart),this.target.removeEventListener("compositionend",this._onCompositionEnd)}catch(e){}this._disconnectObserver(),window.undoBtn&&window.undoBtn.removeEventListener("click",this.performUndo),window.redoBtn&&window.redoBtn.removeEventListener("click",this.performRedo)},m.prototype._disconnectObserver=function(){if(this._observer)try{this._observer.disconnect()}catch(e){}this._observer=null},m.prototype._onInput=function(e){this._suppress||(this._composition?this._scheduleCommit():this._scheduleCommit())},m.prototype._onCutPaste=function(e){this._suppress||this._scheduleCommit(0)},m.prototype._onKeydown=function(e){(e.ctrlKey||e.metaKey)&&!e.altKey&&("z"===e.key||"Z"===e.key?(e.shiftKey?(e.preventDefault(),this.performRedo()):(e.preventDefault(),this.performUndo())):"y"===e.key||"Y"===e.key)&&(e.preventDefault(),this.performRedo())},m.prototype._onCompositionStart=function(){this._composition=!0},m.prototype._onCompositionEnd=function(){this._composition=!1,setTimeout(function(){this._scheduleCommit(0)}.bind(this),this.imeDebounce)},m.prototype._scheduleCommit=function(e){clearTimeout(this._coalesceTimer),0===e?this._commitImmediate("immediate"):this._coalesceTimer=setTimeout(function(){this._commitImmediate("coalesced")}.bind(this),this.coalesceMs)},m.prototype._commitImmediate=function(e){clearTimeout(this._coalesceTimer);if(!this.target)return;var t=l(this.target);if(this._suppress)return;var n=this._undo[this._undo.length-1];if(n&&o(n,t))return;n&&c(n,t)&&n()-n.ts<this.coalesceMs&&!this._composition?(this._undo[this._undo.length-1]=this._createFrame(t),this._undo[this._undo.length-1].ts=n()):this._undoPush(this._createFrame(t)),this._redo=[],this._persist()},m.prototype._wrapProgrammatics=function(){if(this.target){var e=this.target,t=this;try{if(!e.__undov_value_wrapped){var n=Object.getOwnPropertyDescriptor(e,"value")||Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value"),o=n.get||function(){return this.value},i=n.set||function(e){this.value=e};Object.defineProperty(e,"value",{configurable:!0,enumerable:n.enumerable,get:function(){return o.call(this)},set:function(e){t._suppress?i.call(this,e):(i.call(this,e),t.recordNow("setter"))}}),e.__undov_value_wrapped=!0,this._wrapped.value=!0}}catch(n){}try{if("function"==typeof e.setRangeText&&!e.__undov_setRangeText_wrapped){var r=e.setRangeText;e.setRangeText=function(){if(t._suppress)return r.apply(this,arguments);var e=l(this);return n=r.apply(this,arguments),t.recordNow("setRangeText"),n;var n},e.__undov_setRangeText_wrapped=!0,this._wrapped.setRangeText=!0}}catch(n){}}},m.prototype._unwrapProgrammatics=function(){var e=this.target;try{e&&e.__undov_value_wrapped&&delete e.__undov_value_wrapped,e&&e.__undov_setRangeText_wrapped&&delete e.__undov_setRangeText_wrapped}catch(t){}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",v,{once:!0}):setTimeout(v,0),window.HistoryManager=m}();
window.saveNotes=function(){localStorage.setItem("notes",JSON.stringify(window.notes))};
window.updateNoteMetadata=function(){if(window.currentNote&&window.noteTextarea){window.undoStack.push({content:window.currentNote.content,selectionStart:window.noteTextarea.selectionStart,selectionEnd:window.noteTextarea.selectionEnd}),window.redoStack=[],window.currentNote.content=window.noteTextarea.value,window.currentNote.lastEdited=new Date().toISOString(),window.saveNotes(),window.updateDocumentInfo()}};
window.updateDocumentInfo=function(){if(!window.currentNote)window.infoName&&(window.infoName.textContent="-"),window.infoStats&&(window.infoStats.textContent="{0 | 0 | 0} / 0m");else{var e=window.currentNote,t=e.title||"",n=e.content||"",o=e.extension||"",i=n.length,r=n.replace(/\s/g,"").length,a=n.trim().split(/\s+/).filter(function(e){return e}).length,l=Math.ceil(a/200),c=l<60?l+"m":(l/60).toFixed(1)+"h";window.infoName&&(window.infoName.textContent=t+(o?"."+o:"")),window.infoDexLabs&&(window.infoDexLabs.textContent="Dex Labs"),window.infoStats&&(window.infoStats.textContent="{"+r+" | "+i+" | "+a+"} / "+c)}};
window.applyFontSize=function(){window.noteTextarea&&(window.noteTextarea.style.fontSize=window.fontSize+"px",localStorage.setItem("fontSize",window.fontSize))};window.increaseFontSize=function(){window.fontSize=Math.min(window.fontSize+2,42),window.applyFontSize(),window.showNotification("Font size increased to "+window.fontSize+"px")};window.decreaseFontSize=function(){window.fontSize=Math.max(window.fontSize-2,10),window.applyFontSize(),window.showNotification("Font size decreased to "+window.fontSize+"px")};
window.populateNoteList=function(){if(window.noteList){window.noteList.innerHTML="";for(var e=0;e<Math.max(1,window.visibleNotes)&&e<window.notes.length;e++){var t=window.notes[e],n=document.createElement("li");n.className="note-item",n.dataset.id=t.id,n.innerHTML='<span class="note-title">'+t.title+'</span><span class="note-badge">'+t.content.length+" chars | ."+(t.extension||"txt")+"</span>",n.onclick=function(){window.showNoteApp(this.dataset.id)},window.currentNote&&window.currentNote.id===t.id&&n.classList.add("selected"),window.noteList.appendChild(n)}}};
window.openNote=function(e){var t=window.notes.find(function(t){return t.id===e});if(t)t.password?window.checkPassword(t,function(){window.currentNote=t,window.noteTextarea&&(window.noteTextarea.value=t.content),window.updateDocumentInfo(),document.querySelectorAll(".note-item").forEach(function(e){e.classList.remove("selected")});var n=document.querySelector('.note-item[data-id="'+t.id+'"]');n&&n.classList.add("selected")}):(window.currentNote=t,window.noteTextarea&&(window.noteTextarea.value=t.content),window.updateDocumentInfo(),document.querySelectorAll(".note-item").forEach(function(e){e.classList.remove("selected")});var n=document.querySelector('.note-item[data-id="'+t.id+'"]');n&&n.classList.add("selected"))};
window.getNextEmptyNote=function(){return window.notes.find(function(e){return!e.content})};
window.showNotification=function(e){window.notification&&(window.notification.textContent=e,window.notification.classList.add("show"),setTimeout(function(){window.notification.classList.remove("show")},3e3))};
window.handleNewDocument=function(){if(window.visibleNotes>=window.maxNotes)return window.showNotification("Max notes limit reached! Clear a note to continue."),void 0;var e=window.getNextEmptyNote();if(e)window.visibleNotes=1,window.updateNoteVisibility(),window.openNote(e.id),window.showNotification("New document created!");else{var t={id:Date.now().toString(),title:"note"+(window.notes.length+1)+".txt",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""};window.notes.push(t),window.visibleNotes=1,window.updateNoteVisibility(),window.openNote(t.id),window.showNotification("New document created!")}};
window.handleOpenFile=function(){var e=window.getNextEmptyNote();if(!e)return window.showNotification("No empty notes available! Clear a note to continue."),void 0;var t=document.createElement("input");t.type="file",t.accept=".txt,.md,.csv,.json,.xml,.yml,.yaml,.js,.ts,.jsx,.tsx,.html,.css,.py,.java,.c,.cpp,.h,.go,.rb,.php,.rs,.swift,.sh,.bat,Dockerfile,Makefile,.env,.ini,.toml,.conf,.log,.dockerignore",t.onchange=function(n){var o=n.target.files[0];if(o){var i=new FileReader;i.onload=function(n){var o=o.name.split("."),r=o.pop().toLowerCase(),a=o.join(".");e.title=a,e.content=n.target.result,e.extension=r,e.lastEdited=new Date().toISOString(),window.visibleNotes=1,window.updateNoteVisibility(),window.openNote(e.id),window.showNotification("File opened!")},i.readAsText(o)}},t.click()};
window.handlePasteNote=function(){if(!window.currentNote||!window.noteTextarea)return;if(!navigator.clipboard||!navigator.permissions)return window.showNotification("Paste not supported in this browser."),void 0;navigator.permissions.query({name:"clipboard-read"}).then(function(e){if("denied"===e.state)return window.showNotification("Clipboard access denied. Please allow it in your browser settings."),void 0;navigator.clipboard.readText().then(function(e){var t=window.noteTextarea.selectionStart,n=window.noteTextarea.selectionEnd,o=window.noteTextarea.value;window.noteTextarea.value=o.slice(0,t)+e+o.slice(n);var i=t+e.length;window.noteTextarea.selectionStart=window.noteTextarea.selectionEnd=i,window.updateNoteMetadata(),window.showNotification("Pasted from clipboard!")}).catch(function(){window.showNotification("Paste failed (permission denied or empty clipboard).")})})};
window.initDOMReferences=function(){window.homepage=document.getElementById("homepage"),window.noteAppContainer=document.getElementById("noteAppContainer"),window.diffCheckerContainer=document.getElementById("diffCheckerContainer"),window.topbar=document.getElementById("topbar"),window.themeToggle=document.getElementById("themeToggle"),window.undoBtn=document.getElementById("undoBtn"),window.redoBtn=document.getElementById("redoBtn"),window.homeBtn=document.getElementById("homeBtn"),window.sidebar1=document.getElementById("sidebar1"),window.sidebar1Toggle=document.getElementById("sidebar1Toggle"),window.noteList=document.getElementById("noteList"),window.noteTextarea=document.getElementById("noteTextarea"),window.showNextNoteBtn=document.getElementById("showNextNoteBtn"),window.hideLastNoteBtn=document.getElementById("hideLastNoteBtn"),window.sidebar2Toggle=document.getElementById("sidebar2Toggle"),window.secondarySidebar=document.getElementById("secondarySidebar"),window.notification=document.getElementById("notification"),window.noteAppBtn=document.getElementById("noteAppBtn"),window.diffCheckerBtn=document.getElementById("diffCheckerBtn"),window.infoName=document.getElementById("infoName"),window.infoCharsWith=document.getElementById("infoCharsWith"),window.infoCharsWithout=document.getElementById("infoCharsWithout"),window.infoWords=document.getElementById("infoWords"),window.infoReadTime=document.getElementById("infoReadTime"),window.infoExtension=document.getElementById("infoExtension")};
window.setupEventListeners=function(){function e(e,t,n){e?e.addEventListener(t,n):console.warn("Element for "+t+" listener not found")}e(window.homeBtn,"click",function(){window.showHomepage(),window.showNotification("Returned to homepage")}),e(window.sidebar1Toggle,"click",function(e){e.stopPropagation(),window.sidebar1.classList.toggle("open");var t=window.sidebar1.classList.contains("open");window.sidebar1Toggle.innerHTML=t?'<i class="material-symbols-rounded">close</i>':'<i class="material-symbols-rounded">menu</i>'}),document.addEventListener("click",function(e){window.sidebar1&&window.sidebar1Toggle&&!window.sidebar1.contains(e.target)&&!window.sidebar1Toggle.contains(e.target)&&window.sidebar1.classList.contains("open")&&(window.sidebar1.classList.remove("open"),window.sidebar1Toggle.innerHTML='<i class="material-symbols-rounded">menu</i>')}),e(window.noteTextarea,"input",window.updateNoteMetadata),e(window.showNextNoteBtn,"click",function(){window.visibleNotes<window.maxNotes?(window.visibleNotes++,window.updateNoteVisibility(),window.showNotification("Showing "+window.visibleNotes+" note"+(1!==window.visibleNotes?"s":""))):window.showNotification("Max notes limit reached")}),e(window.hideLastNoteBtn,"click",function(){window.visibleNotes>1?(window.visibleNotes--,window.updateNoteVisibility(),window.showNotification("Showing "+window.visibleNotes+" note"+(1!==window.visibleNotes?"s":""))):window.showNotification("Must keep at least one note visible")}),e(window.sidebar2Toggle,"click",function(e){e.stopPropagation(),window.secondarySidebar.classList.toggle("open");var t=window.secondarySidebar.classList.contains("open");window.sidebar2Toggle.innerHTML=t?'<i class="material-symbols-rounded">close</i>':'<i class="material-symbols-rounded">apps</i>'}),document.addEventListener("click",function(e){window.secondarySidebar&&window.sidebar2Toggle&&!window.secondarySidebar.contains(e.target)&&!window.sidebar2Toggle.contains(e.target)&&window.secondarySidebar.classList.contains("open")&&(window.secondarySidebar.classList.remove("open"),window.sidebar2Toggle.innerHTML='<i class="material-symbols-rounded">apps</i>')}),e(window.secondarySidebar,"click",function(e){e.stopPropagation()}),window.addEventListener("focus",window.checkPasswordRequirement)};window.preserveSelection=function(e){return function(){var t=window.noteTextarea.selectionStart,n=window.noteTextarea.selectionEnd;e(),window.noteTextarea.setSelectionRange(t,n)}};window.loadNotes=function(){var e=localStorage.getItem("notes");return e?JSON.parse(e):[{id:"1",title:"example",content:'console.log("Hello, World!");',extension:"js",lastEdited:new Date().toISOString(),password:""},{id:"2",title:"example",content:"<h1>Hello, World!</h1>",extension:"html",lastEdited:new Date().toISOString(),password:""},{id:"3",title:"example",content:"body { background: #fff; }",extension:"css",lastEdited:new Date().toISOString(),password:""},{id:"4",title:"example",content:'print("Hello, World!")',extension:"py",lastEdited:new Date().toISOString(),password:""},{id:"5",title:"note5",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"6",title:"note6",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"7",title:"note7",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"8",title:"note8",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"9",title:"note9",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"10",title:"note10",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"11",title:"note11",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"12",title:"note12",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"13",title:"note13",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"14",title:"note14",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"15",title:"note15",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""}]};window.showHomepage=function(){window.homepage&&window.noteAppContainer&&window.diffCheckerContainer&&(window.homepage.style.display="flex",window.noteAppContainer.style.display="none",window.diffCheckerContainer.style.display="none",window.topbar.style.display="none",window.isHomepage=!0,window.currentApp="home",history.pushState({page:"home"},"","/"))};window.showNoteApp=function(e){if(window.homepage&&window.noteAppContainer&&window.diffCheckerContainer){window.homepage.style.display="none",window.noteAppContainer.style.display="flex",window.diffCheckerContainer.style.display="none",window.topbar.style.display="flex",window.isHomepage=!1,window.currentApp="notes",e?window.history.pushState({page:"note",noteId:e},"","/website/Note/"+e):window.currentNote||0===window.notes.length||0===window.visibleNotes?window.history.pushState({page:"note"},"","/website/Note"):(window.history.pushState({page:"note",noteId:window.notes[0].id},"","/website/Note/"+window.notes[0].id),window.openNote(window.notes[0].id))}};window.showDiffChecker=function(){window.homepage&&window.noteAppContainer&&window.diffCheckerContainer&&(window.homepage.style.display="none",window.noteAppContainer.style.display="none",window.diffCheckerContainer.style.display="flex",window.topbar.style.display="flex",window.isHomepage=!1,window.currentApp="diff",window.history.pushState({page:"diff"},"","/website/DiffChecker"))};window.updateNoteVisibility=function(){localStorage.setItem("visibleNotes",window.visibleNotes),window.populateNoteList()};window.handlePopState=function(){var e=window.location.pathname;if("/"===e||""===e)window.showHomepage();else if(e.startsWith("/website/Note")){var t=e.split("/").pop();t&&window.notes.find(function(e){return e.id===t})?window.showNoteApp(t):window.showNoteApp()}else e.startsWith("/website/DiffChecker")&&window.showDiffChecker()};window.init=function(){window.initDOMReferences(),window.notes=window.loadNotes(),window.updateNoteVisibility(),window.applyFontSize(),window.setupEventListeners(),window.checkPasswordRequirement(),window.handlePopState()};if(window.blogger&&window.blogger.uiReady)window.init();else{document.addEventListener("DOMContentLoaded",window.init);setTimeout(window.init,100)}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("fullscreenBtn"),t=document.getElementById("fullscreenIcon");function n(){var e=document.documentElement;document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function o(){document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement?t.textContent="fullscreen_exit":t.textContent="fullscreen"}e.addEventListener("click",n),document.addEventListener("fullscreenchange",o),document.addEventListener("webkitfullscreenchange",o),document.addEventListener("msfullscreenchange",o)})}();
