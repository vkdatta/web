//<![CDATA[ 
(function() { 'use strict'; 

// 1. CSS Styles (Unchanged)
const minifiedCSS = ` .code-container { position: relative; margin: 20px auto; max-width: 80vw; font-size: 14px; background: #000000; border-radius: 8px; border: 1px solid #333; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); font-family: "Source Code Pro", Monaco, Consolas, "Courier New", monospace; } .code-header { display: flex; justify-content: space-between; align-items: center; padding: 5px; background: #1e1e1e; border-bottom: 1px solid #404040; min-height: 20px; font-family: "Source Code Pro", Monaco, Consolas, "Courier New", monospace; } .language-badge { margin-left:8px; color: #ccc; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; text-transform: none; letter-spacing: 0.5px; background: transparent; font-family: "Source Code Pro", Monaco, Consolas, "Courier New", monospace; } .code-toolbar { display: flex; gap: 2px; align-items: center; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .code-btn { background: transparent; border: none; color: #cacaca; cursor: pointer; padding: 4px 6px; border-radius: 4px; display: flex; align-items: center; justify-content: center; width: 28px; height: 28px; transition: none; font-size: 18px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .code-btn:hover { } .code-btn:active { transform: none; } .code-btn i { font-size: 20px; line-height: 1; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .code-pre { margin: 0; padding: 16px; overflow-x: auto; white-space: pre; color: #d4d4d4; background: transparent; border-radius: 0; line-height: 1.4; tab-size: 4; font-family: "Source Code Pro", Monaco, Consolas, "Courier New", monospace; } .code-pre::-webkit-scrollbar { height: 8px; } .code-pre::-webkit-scrollbar-track { background: #1e1e1e; } .code-pre::-webkit-scrollbar-thumb { background: #404040; border-radius: 4px; } .code-pre::-webkit-scrollbar-thumb:hover { background: #555; } .code-pre.line-wrap { white-space: pre-wrap; word-wrap: break-word; overflow-x: hidden; } .code-content { display: block; margin: 0; font-size: inherit; font-family: "Source Code Pro", Monaco, Consolas, "Courier New", monospace; } .code-container.collapsed .code-pre { max-height: 0; overflow: hidden; position: relative; padding: 0; margin: 0; border: none; } .hidden-lines-indicator { display: none; padding: 8px 16px; color: #888; font-size: 12px; background: #2d2d2d; border-top: 1px solid #333; font-family: "Source Code Pro", Monaco, Consolas, "Courier New", monospace; } .code-container.collapsed .hidden-lines-indicator { display: block; } .copy-success .code-btn i { transform: scale(1.1); } .namespace{opacity:.7}.token.doctype .token.doctype-tag{color:#569CD6}.token.doctype .token.name{color:#9cdcfe}.token.comment,.token.prolog{color:#6a9955}.token.punctuation,.language-html .language-css .token.punctuation,.language-html .language-javascript .token.punctuation{color:#d4d4d4}.token.property,.token.tag,.token.boolean,.token.number,.token.constant,.token.symbol,.token.inserted,.token.unit{color:#b5cea8}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.deleted{color:#ce9178}.language-css .token.string.url{text-decoration:underline}.token.operator,.token.entity{color:#d4d4d4}.token.operator.arrow{color:#569CD6}.token.atrule{color:#ce9178}.token.atrule .token.rule{color:#c586c0}.token.atrule .token.url{color:#9cdcfe}.token.atrule .token.url .token.function{color:#dcdcaa}.token.atrule .token.url .token.punctuation{color:#d4d4d4}.token.keyword{color:#569CD6}.token.keyword.module,.token.keyword.control-flow{color:#c586c0}.token.function,.token.function .token.maybe-class-name{color:#dcdcaa}.token.regex{color:#d16969}.token.important{color:#569cd6}.token.italic{font-style:italic}.token.constant{color:#9cdcfe}.token.class-name,.token.maybe-class-name{color:#4ec9b0}.token.console{color:#9cdcfe}.token.parameter{color:#9cdcfe}.token.interpolation{color:#9cdcfe}.token.punctuation.interpolation-punctuation{color:#569cd6}.token.boolean{color:#569cd6}.token.property,.token.variable,.token.imports .token.maybe-class-name,.token.exports .token.maybe-class-name{color:#9cdcfe}.token.selector{color:#d7ba7d}.token.escape{color:#d7ba7d}.token.tag{color:#569cd6}.token.tag .token.punctuation{color:#808080}.token.cdata{color:#808080}.token.attr-name{color:#9cdcfe}.token.attr-value,.token.attr-value .token.punctuation{color:#ce9178}.token.attr-value .token.punctuation.attr-equals{color:#d4d4d4}.token.entity{color:#569cd6}.token.namespace{color:#4ec9b0}pre[class*="language-javascript"],code[class*="language-javascript"],pre[class*="language-jsx"],code[class*="language-jsx"],pre[class*="language-typescript"],code[class*="language-typescript"],pre[class*="language-tsx"],code[class*="language-tsx"]{color:#9cdcfe}pre[class*="language-css"],code[class*="language-css"]{color:#ce9178}pre[class*="language-html"],code[class*="language-html"]{color:#d4d4d4}.language-regex .token.anchor{color:#dcdcaa}.language-html .token.punctuation{color:#808080}`; const styleEl = document.createElement('style'); styleEl.textContent = minifiedCSS; document.head.appendChild(styleEl); const fontsLink = document.createElement('link'); fontsLink.href = 'https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;600&display=swap'; fontsLink.rel = 'stylesheet'; document.head.appendChild(fontsLink); const iconsLink = document.createElement('link'); iconsLink.href = 'https://fonts.googleapis.com/icon?family=Material+Icons+Round'; iconsLink.rel = 'stylesheet'; document.head.appendChild(iconsLink); 

// 2. Language Loader (Unchanged)
class CompletePrismLanguageLoader { constructor() { this.loadedLanguages = new Set(["markup", "css", "clike", "javascript"]); this.loadingLanguages = new Set(); this.loadPromises = new Map(); this.extensionMap = { html: "markup", htm: "markup", xml: "markup", svg: "markup", mathml: "markup", ssml: "markup", atom: "markup", rss: "markup", css: "css", js: "javascript", mjs: "javascript", cjs: "javascript", abap: "abap", abnf: "abnf", as: "actionscript", actionscript: "actionscript", ada: "ada", adb: "ada", ads: "ada", agda: "agda", al: "al", g4: "antlr4", antlr4: "antlr4", apacheconf: "apacheconf", apex: "apex", apl: "apl", applescript: "applescript", scpt: "applescript", aql: "aql", ino: "arduino", arduino: "arduino", arff: "arff", "arm-asm": "armasm", armasm: "armasm", art: "arturo", arturo: "arturo", adoc: "asciidoc", asciidoc: "asciidoc", aspx: "aspnet", aspnet: "aspnet", asm6502: "asm6502", asmatmel: "asmatmel", ahk: "autohotkey", autohotkey: "autohotkey", au3: "autoit", autoit: "autoit", avs: "avisynth", avisynth: "avisynth", avdl: "avro-idl", awk: "awk", gawk: "awk", sh: "bash", bash: "bash", shell: "bash", zsh: "bash", basic: "basic", bas: "basic", bat: "batch", cmd: "batch", bbcode: "bbcode", shortcode: "bbcode", bbj: "bbj", bicep: "bicep", birb: "birb", bison: "bison", yacc: "bison", bnf: "bnf", rbnf: "bnf", bqn: "bqn", b: "brainfuck", bf: "brainfuck", brainfuck: "brainfuck", brs: "brightscript", brightscript: "brightscript", bro: "bro", bsl: "bsl", oscript: "bsl", c: "c", h: "c", cs: "csharp", csharp: "csharp", dotnet: "csharp", cpp: "cpp", cc: "cpp", cxx: "cpp", "c++": "cpp", hpp: "cpp", hxx: "cpp", cfc: "cfscript", cfscript: "cfscript", chai: "chaiscript", chaiscript: "chaiscript", cil: "cil", cilkc: "cilkc", "cilk-c": "cilkc", cilkcpp: "cilkcpp", "cilk-cpp": "cilkcpp", cilk: "cilkcpp", clj: "clojure", cljs: "clojure", cljc: "clojure", edn: "clojure", cmake: "cmake", cob: "cobol", cbl: "cobol", cobol: "cobol", coffee: "coffeescript", coffeescript: "coffeescript", conc: "concurnas", concurnas: "concurnas", csp: "csp", cook: "cooklang", cooklang: "cooklang", coq: "coq", v: "coq", cr: "crystal", crystal: "crystal", "css-extras": "css-extras", csv: "csv", cue: "cue", cypher: "cypher", d: "d", di: "d", dart: "dart", dw: "dataweave", dataweave: "dataweave", dax: "dax", dhall: "dhall", diff: "diff", patch: "diff", django: "django", jinja: "django", jinja2: "django", "dns-zone": "dns-zone-file", zone: "dns-zone-file", dockerfile: "docker", docker: "docker", dot: "dot", gv: "dot", ebnf: "ebnf", editorconfig: "editorconfig", e: "eiffel", eiffel: "eiffel", ejs: "ejs", eta: "ejs", erb: "erb", rhtml: "erb", erl: "erlang", hrl: "erlang", erlang: "erlang", xlsx: "excel-formula", xls: "excel-formula", fs: "fsharp", fsx: "fsharp", fsi: "fsharp", factor: "factor", false: "false", firestore: "firestore-security-rules", flow: "flow", f: "fortran", f90: "fortran", f95: "fortran", f03: "fortran", ftl: "ftl", gml: "gml", gamemakerlanguage: "gml", gap: "gap", gi: "gap", gd: "gap", gcode: "gcode", nc: "gcode", gdscript: "gdscript", ged: "gedcom", gedcom: "gedcom", po: "gettext", pot: "gettext", gettext: "gettext", feature: "gherkin", gherkin: "gherkin", git: "git", glsl: "glsl", vert: "glsl", frag: "glsl", gn: "gn", gni: "gn", ld: "linker-script", go: "go", mod: "go-module", sum: "go-module", gradle: "gradle", graphql: "graphql", gql: "graphql", groovy: "groovy", gvy: "groovy", haml: "haml", hbs: "handlebars", handlebars: "handlebars", mustache: "handlebars", hs: "haskell", lhs: "haskell", haskell: "haskell", hx: "haxe", haxe: "haxe", hcl: "hcl", tf: "hcl", hlsl: "hlsl", hoon: "hoon", http: "http", hpkp: "hpkp", hsts: "hsts", ichigojam: "ichigojam", icn: "icon", icon: "icon", icu: "icu-message-format", idr: "idris", lidr: "idris", idris: "idris", gitignore: "ignore", hgignore: "ignore", npmignore: "ignore", ni: "inform7", i7x: "inform7", ini: "ini", cfg: "ini", conf: "ini", properties: "ini", io: "io", ijs: "j", j: "j", java: "java", javadoc: "javadoc", javadoclike: "javadoclike", javastacktrace: "javastacktrace", jexl: "jexl", jolie: "jolie", ol: "jolie", jq: "jq", jsdoc: "jsdoc", "js-extras": "js-extras", json: "json", webmanifest: "json", json5: "json5", jsonp: "jsonp", jsstacktrace: "jsstacktrace", "js-templates": "js-templates", jl: "julia", julia: "julia", keepalived: "keepalived", kmn: "keyman", keyman: "keyman", kt: "kotlin", kts: "kotlin", kotlin: "kotlin", kum: "kumir", kumir: "kumir", kql: "kusto", kusto: "kusto", tex: "latex", latex: "latex", sty: "latex", cls: "latex", latte: "latte", less: "less", ly: "lilypond", ily: "lilypond", liquid: "liquid", lisp: "lisp", el: "lisp", emacs: "lisp", elisp: "lisp", ls: "livescript", livescript: "livescript", ll: "llvm", llvm: "llvm", log: "log", lol: "lolcode", lolcode: "lolcode", lua: "lua", magma: "magma", makefile: "makefile", mk: "makefile", mak: "makefile", md: "markdown", markdown: "markdown", "markup-templating": "markup-templating", mata: "mata", matah: "mata", m: "matlab", matlab: "matlab", ms: "maxscript", mcr: "maxscript", mel: "mel", mermaid: "mermaid", mmd: "mermaid", mf: "metafont", mp: "metafont", miz: "mizar", mizar: "mizar", mongodb: "mongodb", monkey: "monkey", monkey2: "monkey", moon: "moonscript", moonscript: "moonscript", n1ql: "n1ql", n4js: "n4js", n4jsd: "n4js", hdl: "nand2tetris-hdl", nani: "naniscript", naniscript: "naniscript", nasm: "nasm", asm: "nasm", neon: "neon", nevod: "nevod", nginx: "nginx", nginxconf: "nginx", nim: "nim", nims: "nim", nimble: "nim", nix: "nix", nsi: "nsis", nsh: "nsis", objc: "objectivec", "objective-c": "objectivec", m: "objectivec", ml: "ocaml", mli: "ocaml", ocaml: "ocaml", odin: "odin", cl: "opencl", opencl: "opencl", qasm: "openqasm", openqasm: "openqasm", oz: "oz", gp: "parigp", pari: "parigp", parser: "parser", pas: "pascal", p: "pascal", pp: "pascal", ligo: "pascaligo", pascaligo: "pascaligo", psl: "psl", px: "pcaxis", pcaxis: "pcaxis", pcode: "peoplecode", peoplecode: "peoplecode", pl: "perl", pm: "perl", perl: "perl", php: "php", php3: "php", php4: "php", php5: "php", phpdoc: "phpdoc", "php-extras": "php-extras", plantuml: "plant-uml", puml: "plant-uml", "plant-uml": "plant-uml", sql: "plsql", pls: "plsql", plb: "plsql", pq: "powerquery", powerquery: "powerquery", mscript: "powerquery", ps1: "powershell", ps1xml: "powershell", psc1: "powershell", pde: "processing", processing: "processing", pro: "prolog", prolog: "prolog", pl: "prolog", promql: "promql", properties: "properties", proto: "protobuf", protobuf: "protobuf", pug: "pug", jade: "pug", pp: "puppet", puppet: "puppet", pure: "pure", pb: "purebasic", pbi: "purebasic", purs: "purescript", purescript: "purescript", py: "python", pyw: "python", python: "python", qs: "qsharp", qsharp: "qsharp", q: "q", qml: "qml", qore: "qore", q: "qore", r: "r", R: "r", rkt: "racket", rktd: "racket", cshtml: "cshtml", razor: "cshtml", jsx: "jsx", tsx: "tsx", re: "reason", rei: "reason", regex: "regex", regexp: "regex", rego: "rego", rpy: "renpy", rpym: "renpy", res: "rescript", resi: "rescript", rst: "rest", rest: "rest", rip: "rip", graph: "roboconf", instances: "roboconf", robot: "robotframework", resource: "robotframework", rb: "ruby", rbw: "ruby", ruby: "ruby", rs: "rust", rust: "rust", sas: "sas", sass: "sass", scss: "scss", scala: "scala", sc: "scala", scm: "scheme", ss: "scheme", scheme: "scheme", "sh-session": "shell-session", "shell-session": "shell-session", smali: "smali", st: "smalltalk", smalltalk: "smalltalk", tpl: "smarty", smarty: "smarty", sml: "sml", fun: "sml", sig: "sml", sol: "solidity", solidity: "solidity", sln: "solution-file", soy: "soy", sparql: "sparql", rq: "sparql", spl: "splunk-spl", sqf: "sqf", sql: "sql", nut: "squirrel", squirrel: "squirrel", stan: "stan", do: "stata", ado: "stata", st: "iecst", iecst: "iecst", styl: "stylus", stylus: "stylus", sc: "supercollider", scd: "supercollider", swift: "swift", service: "systemd", socket: "systemd", device: "systemd", t4: "t4-templating", tt: "t4-cs", "vb-t4": "t4-vb", tap: "tap", tcl: "tcl", tk: "tcl", tt: "tt2", tt2: "tt2", textile: "textile", toml: "toml", troy: "tremor", trickle: "tremor", ttl: "turtle", trig: "turtle", twig: "twig", ts: "typescript", typescript: "typescript", tsconfig: "typoscript", ts: "typoscript", uc: "unrealscript", uci: "unrealscript", uorazor: "uorazor", uri: "uri", url: "uri", v: "v", vala: "vala", vapi: "vala", vb: "vbnet", vbnet: "vbnet", vm: "velocity", velocity: "velocity", verilog: "verilog", vh: "verilog", vhd: "vhdl", vhdl: "vhdl", vim: "vim", vimrc: "vim", "visual-basic": "visual-basic", bas: "visual-basic", warpscript: "warpscript", wast: "wasm", wat: "wasm", "web-idl": "web-idl", wgsl: "wgsl", wiki: "wiki", wl: "wolfram", nb: "wolfram", m: "wolfram", wren: "wren", xeoracube: "xeora", "xml-doc": "xml-doc", xojo: "xojo", xq: "xquery", xquery: "xquery", yml: "yaml", yaml: "yaml", yang: "yang", zig: "zig", txt: "none", vba: "vba" }; this.dependencies = { jsx: ["javascript"], tsx: ["typescript", "jsx"], typescript: ["javascript"], scss: ["css"], sass: ["css"], less: ["css"], stylus: ["css"], php: ["markup"], erb: ["ruby", "markup"], aspnet: ["csharp", "markup"], handlebars: ["markup"], django: ["markup"], twig: ["markup"], liquid: ["markup"], pug: ["markup"], haml: ["markup"], cshtml: ["csharp", "markup"], "plant-uml": ["markup"], "t4-cs": ["csharp", "t4-templating"], "t4-vb": ["visual-basic", "t4-templating"], "markup-templating": ["markup"] }; this.primaryExtensionMap = {}; this.buildPrimaryExtensionMap(); } buildPrimaryExtensionMap() { for (const [ext, lang] of Object.entries(this.extensionMap)) { if (!this.primaryExtensionMap[lang]) { this.primaryExtensionMap[lang] = ext; } } } detectLanguageFromExtension(ext) { return this.extensionMap[ext.toLowerCase()] || "none"; } getLanguageDisplayName(langAttr) { const lang = this.detectLanguageFromExtension(langAttr); return this.primaryExtensionMap[lang] || langAttr.toLowerCase(); } async loadLanguage(lang) { if (!lang || lang === "none") return Promise.resolve(); if (this.loadedLanguages.has(lang)) return Promise.resolve(); if (this.loadPromises.has(lang)) return this.loadPromises.get(lang); const loadPromise = this._loadLanguage(lang); this.loadPromises.set(lang, loadPromise); return loadPromise; } async _loadLanguage(lang) { if (this.loadedLanguages.has(lang) || this.loadingLanguages.has(lang)) return; this.loadingLanguages.add(lang); const script = document.createElement('script'); script.src = `https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-${lang}.min.js`; return new Promise((resolve, reject) => { script.onload = () => { this.loadedLanguages.add(lang); this.loadingLanguages.delete(lang); resolve(); }; script.onerror = () => { this.loadingLanguages.delete(lang); reject(new Error(`Failed to load language: ${lang}`)); }; document.head.appendChild(script); }); } isLanguageLoaded(lang) { return this.loadedLanguages.has(lang); } } const languageLoader = new CompletePrismLanguageLoader(); function fastEscapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; } 

// 3. Helper Functions (Modified to support dynamic updates)
async function highlightCodeBlock(originalCode, newCodeElement) { const langAttr = originalCode.getAttribute('lang') || 'txt'; const lang = languageLoader.detectLanguageFromExtension(langAttr); const displayName = languageLoader.getLanguageDisplayName(langAttr); const codeText = originalCode.textContent.trim(); const lineCount = codeText.split('\n').length; newCodeElement.textContent = codeText; if (lang !== "none") { try { await languageLoader.loadLanguage(lang); if (window.Prism && languageLoader.isLanguageLoaded(lang)) { newCodeElement.className = `code-content language-${lang}`; Prism.highlightElement(newCodeElement); } } catch (error) { console.warn(`Failed to highlight ${lang}:`, error); newCodeElement.innerHTML = fastEscapeHtml(codeText); } } else { newCodeElement.innerHTML = fastEscapeHtml(codeText); } return { displayName, lineCount }; } function createCodeBlockStructure(originalCode, codeContent, displayName, lineCount) { const container = document.createElement('div'); container.className = 'code-container'; const header = document.createElement('div'); header.className = 'code-header'; const languageBadge = document.createElement('span'); languageBadge.className = 'language-badge'; languageBadge.textContent = displayName; header.appendChild(languageBadge); const toolbar = document.createElement('div'); toolbar.className = 'code-toolbar'; const collapseBtn = document.createElement('span'); collapseBtn.className = 'code-btn collapse-btn'; collapseBtn.title = 'Collapse code block'; collapseBtn.innerHTML = '<i class="material-icons-round">unfold_less</i>'; let isCollapsed = false; toolbar.appendChild(collapseBtn); const wrapBtn = document.createElement('span'); wrapBtn.className = 'code-btn wrap-btn'; wrapBtn.title = 'Toggle line wrap'; wrapBtn.innerHTML = '<i class="material-icons-round">wrap_text</i>'; let isWrapped = false; toolbar.appendChild(wrapBtn); const copyBtn = document.createElement('span'); copyBtn.className = 'code-btn copy-btn'; copyBtn.title = 'Copy code'; copyBtn.innerHTML = '<i class="material-icons-round">content_copy</i>'; toolbar.appendChild(copyBtn); header.appendChild(toolbar); container.appendChild(header); const pre = document.createElement('pre'); pre.className = 'code-pre'; pre.appendChild(codeContent); container.appendChild(pre); const hiddenLinesIndicator = document.createElement('div'); hiddenLinesIndicator.className = 'hidden-lines-indicator'; hiddenLinesIndicator.innerHTML = `<span>${lineCount} lines hidden</span>`; container.appendChild(hiddenLinesIndicator); copyBtn.addEventListener('click', (e) => { e.stopPropagation(); const codeToCopy = codeContent.textContent; navigator.clipboard.writeText(codeToCopy).then(() => { const icon = copyBtn.querySelector('i'); const originalHTML = icon.innerHTML; icon.innerHTML = 'check'; copyBtn.parentNode.parentNode.parentNode.classList.add('copy-success'); setTimeout(() => { icon.innerHTML = originalHTML; copyBtn.parentNode.parentNode.parentNode.classList.remove('copy-success'); }, 2000); }).catch(err => { console.error('Failed to copy:', err); }); }); wrapBtn.addEventListener('click', () => { isWrapped = !isWrapped; pre.classList.toggle('line-wrap', isWrapped); wrapBtn.innerHTML = isWrapped ? '<i class="material-icons-round">code</i>' : '<i class="material-icons-round">wrap_text</i>'; wrapBtn.title = isWrapped ? "Unwrap lines" : "Wrap lines"; }); collapseBtn.addEventListener('click', () => { isCollapsed = !isCollapsed; container.classList.toggle('collapsed', isCollapsed); if (isCollapsed) { collapseBtn.innerHTML = '<i class="material-icons-round">unfold_more</i>'; collapseBtn.title = "Expand code block"; } else { collapseBtn.innerHTML = '<i class="material-icons-round">unfold_less</i>'; collapseBtn.title = "Collapse code block"; } }); return container; } 

// 4. Transform Logic (Extracted for reusability)
// This marks the element as 'processing' so we don't infinitely recurse
async function transformCodeElement(originalCode) {
    // Safety check: Prevent double processing or processing of already wrapped code
    if (originalCode.dataset.processed === "true") return;
    if (originalCode.parentNode.classList.contains('code-container')) return;
    if (originalCode.classList.contains('code-content')) return; // already inside a block
    
    // Mark as processed immediately to prevent observer race conditions
    originalCode.dataset.processed = "true";

    try {
        const newCodeElement = document.createElement('code');
        const { displayName, lineCount } = await highlightCodeBlock(originalCode, newCodeElement);
        const container = createCodeBlockStructure(originalCode, newCodeElement, displayName, lineCount);
        
        // Double check parent still exists before replacing (async issues)
        if (originalCode.parentNode) {
            originalCode.parentNode.replaceChild(container, originalCode);
        }
    } catch (error) {
        console.error('Error processing code block:', error);
        // Fallback simplified structure
        const container = document.createElement('div');
        container.className = 'code-container';
        container.innerHTML = ` <div class="code-header"> <span class="language-badge">txt</span> <div class="code-toolbar"> <span class="code-btn collapse-btn" title="Collapse code block"> <i class="material-icons-round">unfold_less</i> </span> <span class="code-btn wrap-btn" title="Toggle line wrap"> <i class="material-icons-round">wrap_text</i> </span> <span class="code-btn copy-btn" title="Copy code"> <i class="material-icons-round">content_copy</i> </span> </div> </div> <pre class="code-pre">${fastEscapeHtml(originalCode.textContent)}</pre> <div class="hidden-lines-indicator"> <span>${originalCode.textContent.trim().split('\n').length} lines hidden</span> </div> `;
        if (originalCode.parentNode) {
            originalCode.parentNode.replaceChild(container, originalCode);
        }
    }
}

async function initCodeBlocks() { 
    if (!window.Prism) { await new Promise((resolve, reject) => { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js'; script.onload = resolve; script.onerror = reject; document.head.appendChild(script); }); } 
    
    // Process existing blocks
    const codeElements = document.querySelectorAll('code'); 
    for (const originalCode of codeElements) { 
        transformCodeElement(originalCode);
    } 

    // 5. SETUP MUTATION OBSERVER
    // This watches for any new nodes added via .innerHTML, .appendChild, etc.
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'childList') {
                mutation.addedNodes.forEach((node) => {
                    // If the added node is a generic ELEMENT (div, p, etc)
                    if (node.nodeType === 1) { 
                        // Check if the node itself is a CODE tag
                        if (node.tagName === 'CODE') {
                            transformCodeElement(node);
                        }
                        // Check if the node CONTAINS code tags (e.g. user injected a whole div)
                        else if (node.querySelectorAll) {
                            const nestedCodes = node.querySelectorAll('code');
                            nestedCodes.forEach(transformCodeElement);
                        }
                    }
                });
            }
        });
    });

    // Start observing the document body for added nodes
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
} 

if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', initCodeBlocks); } else { setTimeout(initCodeBlocks, 0); } })(); 
//]]>
