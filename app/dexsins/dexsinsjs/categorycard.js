(function () { const products = document.getElementById('products'); if (!products) return; const baseLeft = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--base-left')) || 12; const indentUnit = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--indent-unit')) || 28; function getTransitionMs() { const val = getComputedStyle(document.documentElement).getPropertyValue('--transition-speed').trim(); return Math.round((parseFloat(val) || 0.15) * 1000); } function collapse(elem, done) { elem.style.overflow = 'hidden'; elem.style.height = elem.scrollHeight + 'px'; elem.getBoundingClientRect(); requestAnimationFrame(() => { elem.style.height = '0'; }); setTimeout(() => { elem.style.height = ''; elem.setAttribute('aria-hidden','true'); elem.style.overflow = 'hidden'; if (done) done(); }, getTransitionMs() + 20); } function expand(elem, done) { elem.style.height = '0'; elem.setAttribute('aria-hidden','false'); elem.getBoundingClientRect(); const target = elem.scrollHeight + 'px'; requestAnimationFrame(() => { elem.style.height = target; }); setTimeout(() => { elem.style.height = 'auto'; elem.style.overflow = 'auto'; if (done) done(); }, getTransitionMs() + 20); } function buildTopLevel(container, dataContainer, depth = 0) { const indent = depth * indentUnit; const totalLeft = baseLeft + indent; Array.from(dataContainer.children).forEach(dataDiv => { const isCollapse = dataDiv.classList.contains('collapse'); const text = dataDiv.getAttribute('text') || ''; const icon = dataDiv.getAttribute('icon') || ''; const vlineLeft = (totalLeft + 7) + 'px'; const group = document.createElement('div'); group.className = `category-group${isCollapse && dataDiv.classList.contains('open') ? ' open' : ''}`; if (isCollapse) group.classList.add('has-line'); const header = document.createElement(isCollapse ? 'button' : 'div'); header.type = 'button'; header.className = 'category-header'; header.style.paddingLeft = totalLeft + 'px'; const left = document.createElement('span'); left.className = 'left'; const i = document.createElement('span'); i.className = 'material-symbols-rounded'; i.textContent = icon; const l = document.createElement('span'); l.className = 'label'; l.textContent = text; left.append(i, l); header.append(left); if (isCollapse) { group.style.setProperty('--vline-left', vlineLeft); const ch = document.createElement('span'); ch.className = 'material-symbols-rounded chevron'; ch.textContent = 'expand_more'; header.append(ch); header.onclick = () => toggleGroup(header); header.setAttribute('aria-expanded', dataDiv.classList.contains('open') ? 'true' : 'false'); const content = document.createElement('div'); content.className = 'category-content'; content.setAttribute('aria-hidden', dataDiv.classList.contains('open') ? 'false' : 'true'); group.append(header, content); container.append(group); buildSubLevel(content, dataDiv, depth + 1); } else { const onclickAttr = dataDiv.getAttribute('onclick'); if (onclickAttr) { header.setAttribute('onclick', onclickAttr); header.style.cursor = 'pointer'; } group.append(header); container.append(group); } }); } function buildSubLevel(container, dataContainer, depth) { const indent = depth * indentUnit; const totalLeft = baseLeft + indent; Array.from(dataContainer.children).forEach(dataDiv => { const isCollapse = dataDiv.classList.contains('collapse'); const text = dataDiv.getAttribute('text') || ''; const icon = dataDiv.getAttribute('icon') || ''; const vlineLeft = (totalLeft + 7) + 'px'; if (isCollapse) { const group = document.createElement('div'); group.className = `nav-item-group${dataDiv.classList.contains('open') ? ' open' : ''}`; group.classList.add('has-line'); group.style.setProperty('--vline-left', vlineLeft); const toggle = document.createElement('button'); toggle.type = 'button'; toggle.className = 'nav-toggle'; toggle.style.paddingLeft = totalLeft + 'px'; const left = document.createElement('span'); left.className = 'left'; const i = document.createElement('span'); i.className = 'material-symbols-rounded'; i.textContent = icon; const l = document.createElement('span'); l.className = 'label'; l.textContent = text; left.append(i, l); toggle.append(left); const ch = document.createElement('span'); ch.className = 'material-symbols-rounded chevron'; ch.textContent = 'expand_more'; toggle.append(ch); toggle.onclick = () => toggleGroup(toggle); toggle.setAttribute('aria-expanded', dataDiv.classList.contains('open') ? 'true' : 'false'); const sublist = document.createElement('div'); sublist.className = 'sub-list'; sublist.setAttribute('aria-hidden', dataDiv.classList.contains('open') ? 'false' : 'true'); group.append(toggle, sublist); container.append(group); buildSubLevel(sublist, dataDiv, depth + 1); } else { const item = document.createElement('button'); item.type = 'button'; item.className = 'sub-item'; item.style.paddingLeft = totalLeft + 'px'; const onclickAttr = dataDiv.getAttribute('onclick'); if (onclickAttr) { item.setAttribute('onclick', onclickAttr); } const i = document.createElement('span'); i.className = 'material-symbols-rounded'; i.textContent = icon; item.append(i, document.createTextNode(text)); container.append(item); } }); } const cardScroll = document.querySelector('.category-scroll'); if (products) { buildTopLevel(cardScroll, products, 0); products.remove(); document.querySelectorAll('.category-group.has-line, .nav-item-group.has-line').forEach(group => { const header = group.querySelector('.category-header, .nav-toggle'); if (header) { header.offsetHeight; const headerHeight = header.offsetHeight; group.style.setProperty('--line-top', headerHeight + 'px'); } }); } window.toggleGroup = function(btn) { const group = btn.closest('.category-group, .nav-item-group'); if (!group) return; const content = group.querySelector('.category-content, .sub-list'); if (!content) return; const isOpen = group.classList.contains('open'); if (group.classList.contains('category-group')) { if (!isOpen) { const others = Array.from(document.querySelectorAll('.category-group.open')) .filter(g => g !== group); others.forEach(o => { const c = o.querySelector('.category-content'); const b = o.querySelector('.category-header'); o.classList.remove('open'); if (b) b.setAttribute('aria-expanded','false'); if (c) collapse(c); }); group.classList.add('open'); btn.setAttribute('aria-expanded','true'); expand(content); } else { group.classList.remove('open'); btn.setAttribute('aria-expanded','false'); collapse(content); } return; } const parent = group.parentElement.closest('.nav-item-group, .category-group'); if (parent) { const siblings = Array.from(parent.querySelectorAll('.nav-item-group')); siblings.forEach(sib => { if (sib !== group && sib.classList.contains('open')) { const sc = sib.querySelector('.sub-list'); const sb = sib.querySelector('.nav-toggle'); sib.classList.remove('open'); if (sb) sb.setAttribute('aria-expanded','false'); if (sc) collapse(sc); } }); } if (!isOpen) { group.classList.add('open'); btn.setAttribute('aria-expanded','true'); expand(content); } else { group.classList.remove('open'); btn.setAttribute('aria-expanded','false'); collapse(content); } }; document.querySelectorAll('.category-group.open, .nav-item-group.open').forEach(g => { const content = g.querySelector('.category-content, .sub-list'); if (content) { content.style.height = 'auto'; content.style.overflow = 'auto'; content.removeAttribute('aria-hidden'); const btn = g.querySelector('.category-header, .nav-toggle'); if (btn) btn.setAttribute('aria-expanded','true'); } }); })();
